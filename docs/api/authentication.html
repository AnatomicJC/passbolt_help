<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Authentication in passbolt</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         © 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="The help site for passbolt, the open source password manager for teams. This site contains frequently asked questions, article to troubleshoot common issues,...">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Authentication in passbolt" />
    <meta property="og:description" content="The help site for passbolt, the open source password manager for teams. This site contains frequently asked questions, article to troubleshoot common issues,..." />

    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="canonical" href="https://help.passbolt.com/api/authentication">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">

</head>

<body>
<div id="container" class="help page background">
    <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" target="_blank" rel="noopener"><span>demo</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="//help.passbolt.com/"><span>help</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_pages/api/authentication.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

    <div class="panel main" aria-label="Content">
        <div class="panel left">
            <div class="navigation wizard" role="navigation">
  <ul>
      <li><h2>passbolt API</h2></li>
      

      
      <li>
      
          <a href="https://help.passbolt.com/api">Introduction</a>
      </li>
      

      
      <li class="selected">
      
          <a href="https://help.passbolt.com/api/authentication">Authentication</a>
      </li>
      

      
      <li>
      
          <a href="https://help.passbolt.com/api/resources">Resources</a>
      </li>
      

      
      <li>
      
          <a href="https://help.passbolt.com/api/users">Users</a>
      </li>
      

      
      <li>
      
          <a href="https://help.passbolt.com/api/groups">Groups</a>
      </li>
      

      
      <li>
      
          <a href="https://help.passbolt.com/api/gpgkeys">GPG Keys</a>
      </li>
      

      
      <li>
      
          <a href="https://help.passbolt.com/api/comments">Comments</a>
      </li>
      
  </ul>
</div>

        </div>
        <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
            <div class="grid grid-responsive-12">
                <article>
                    <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/api"><span>api</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/api/authentication"><span>authentication</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>


                    <div class="row" markdown="1">
                        <div class="col8" markdown="1">
                         <h1>Authentication in passbolt</h1>
                            <h2 id="gpgauth">gpgAuth</h2>

<p>Instead of a conventional form based login system, passbolt uses the <a href="https://gpgauth.org/">gpgAuth</a> protocol for authenticating its clients. It is a challenge based authentication similar to what you would find in protocol such as SSH. You can read more about the authentication process <a href="https://help.passbolt.com/tech/auth">here</a>.</p>

<div class="message warning">
    <p>
        <b>Notice:</b> At the time of writing, the gpgAuth website was found to have some issues with it’s HTTPS certificate. If you wish to access their website, you can do so by adding an exception in your browser.
    </p>
    
</div>

<h3 id="gpgauth-response-headers">gpgAuth response headers</h3>

<p>GpgAuth uses a set of custom HTTP headers to send information to the client.</p>

<table class="table-parameters">
  <thead>
    <tr>
      <th>Header</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
  <tr>
   <td>X-GPGAuth-Verify-Response
   </td>
   <td>The solved challenge that the server decrypted. The client compares it with the one stored locally and confirms server’s identity.
   </td>
  </tr>
  <tr>
   <td>X-GPGAuth-Progress
   </td>
   <td>The current login stage number. Possible values are verify, stage0, stage1, complete and logout.
   </td>
  </tr>
  <tr>
   <td>X-GPGAuth-User-Auth-Token
   </td>
   <td>An encrypted token sent from the server for the client to decrypt and hence confirm it’s identity.
   </td>
  </tr>
  <tr>
   <td>X-GPGAuth-Refer
   </td>
   <td>URI of the last location which triggered the login process. Used to redirect back after a successful login.
   </td>
  </tr>
  <tr>
   <td>X-GPGAuth-Error
   </td>
   <td>Any information with regards to an authentication error
   </td>
  </tr>
  <tr>
   <td>X-GPGAuth-Pubkey
   </td>
   <td>The server public key url
   </td>
  </tr>
  <tr>
   <td>X-GPGAuth-Logout-Url
   </td>
   <td>The logout URL
   </td>
  </tr>
  <tr>
   <td>X-GPGAuth-Version
   </td>
   <td>GPGAuth version
   </td>
  </tr>
  </tbody>
</table>

<h3 id="verify-step">Verify Step</h3>

<p>The verify step is used the verify your passbolt server’s integrity. It is recommended, but optional, for a client to verify the server key. It involves</p>

<ol>
  <li>Creating a cryptographically secure random token and store it locally.</li>
  <li>Encrypt it for the server using the <a href="/api#accessing-passbolt-server-public-key">broadcasted public key</a>.</li>
  <li>
    <p>Make a POST request to /auth/verify.json and send the token in request body under gpg_auth[‘server_verify_token’]</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ```php
 'data' =&gt; [
     'gpg_auth' =&gt; [
         'keyid' =&gt; &lt;fingerprint_of_the_user&gt;,
         'server_verify_token' =&gt; &lt;Encrypted_token&gt;
     ]
 ]
 ```
</code></pre></div>    </div>
  </li>
  <li>
    <p>In the response look for the <code class="highlighter-rouge">X-GPGAuth-Verify-Response</code> header and check if it’s value matches with the locally stored value in step 1.</p>
  </li>
  <li>Proceed to the login step only if they match.</li>
</ol>

<h3 id="login-steps">Login Steps</h3>

<p>Step 1: The user sends their key fingerprint.</p>

<p>To get your GPG key fingerprint, you can use <code class="highlighter-rouge">gpg --fingerprint</code> command. It’ll output a list of fingerprint the current user has access to.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gpg <span class="nt">--fingerprint</span>

/Users/abhinav/.gnupg/pubring.kbx
<span class="nt">---------------------------------</span>
pub   dsa2048 2010-08-19 <span class="o">[</span>SC] <span class="o">[</span>expires: 2020-06-15]
      85E3 8F69 046B 44C1 EC9F  B07B 76D7 8F05 00D0 26C4
uid           <span class="o">[</span> unknown] GPGTools Team &lt;team@gpgtools.org&gt;
sub   elg2048 2010-08-19 <span class="o">[</span>E] <span class="o">[</span>expires: 2020-06-15]
sub   rsa4096 2014-04-08 <span class="o">[</span>S] <span class="o">[</span>expires: 2024-01-02]

pub   rsa4096 2019-03-13 <span class="o">[</span>SC] <span class="o">[</span>expires: 2023-03-13]
      E240 E31A FE3D 92A8 33A7  F2FE C98B E203 3795 B6B6
uid           <span class="o">[</span>ultimate] Abhinav Kumar &lt;abhinav@passbolt.com&gt;
sub   rsa4096 2019-03-13 <span class="o">[</span>E] <span class="o">[</span>expires: 2023-03-13]
</code></pre></div></div>

<p>The client sends the fingerprint of the user’s key via a POST request.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /auth/login.json
</code></pre></div></div>

<p>The request body looks like</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'gpg_auth'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'keyid'</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">fingerprint_of_the_user</span><span class="o">&gt;</span>
    <span class="p">]</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Step 1.1: A matching key is not found. The server returns a <code class="highlighter-rouge">HTTP NOT FOUND</code> response meaning the user with the given fingerprint does not access to your passbolt server.</p>

<p>Step 1.2: A matching key is found. The server then generates a random token, stores it locally and then encrypts it with the user’s public key found in the previous step. The encrypted token is then sent in the <code class="highlighter-rouge">X-GPGAuth-User-Auth-Token</code> header to the client. An example response looks like this.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x-frame-options: sameorigin
X-GPGAuth-Authenticated: false
X-GPGAuth-Login-URL: /auth/login
X-GPGAuth-Logout-URL: /auth/logout
X-GPGAuth-Progress: stage1
X-GPGAuth-Pubkey-URL: /auth/verify.json
X-GPGAuth-User-Auth-Token: -----BEGIN\+PGP\+MESSAGE-----
X-GPGAuth-Verify-URL: /auth/verify
X-GPGAuth-Version: 1.3.0
x-permitted-cross-domain-policies: all
x-xss-protection: 1; mode=block
</code></pre></div></div>

<p class="message notice">
    For better readability the usual response headers like <code>Cache-Control, Content-Type, Date, Expires</code> etc. are omitted above.
</p>

<p>Step 1.3: The client then decrypts the encrypted token</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"&lt;encrypted_token_from_server&gt;"</span> | gpg <span class="nt">-d</span>
</code></pre></div></div>

<p>Hence verifying the ownership of the fingerprint sent in step 1. You’ll require to enter your GPG key passphrase to decrypt the token.</p>

<p>After decrypting, the client will send the decrypted (plaintext) data back to the server for verification.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /auth/login.json
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'gpg_auth'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'keyid'</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">same_fingerprint_as_step1</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="s1">'user_token_result'</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="nx">decrypted_token_in_plaintext</span><span class="o">&gt;</span> 
    <span class="p">]</span>
<span class="p">]</span>
</code></pre></div></div>

<p>Step 1.4: Finally the server verifies the plaintext token against the one stored locally in step 1.2 and upon success</p>

<ul>
  <li>Initiates a session</li>
  <li>Logs the user in</li>
  <li>Generates a secure token and sends to the client as a cookie called “csrfToken”</li>
</ul>

<h3 id="working-with-csrf-token">Working with CSRF token</h3>

<p>To prevent <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">Cross Site Request Forgery or CSRF</a> attacks a CSRF token must be included in all future requests that affects the integrity of the data (e.g. a resource edit or a user delete action for example). This makes sure that an attaquer can not create a malicious website that would trigger an action in passbolt, e.g prevent “clickjacking”.</p>

<p>You can access this CSRF when accessing any read endpoint using the cookie <code class="highlighter-rouge">csrfToken</code>. In addition to request data parameters, CSRF tokens can be submitted through a special <code class="highlighter-rouge">X-CSRF-Token</code> header. Using a header often makes it easier to integrate a CSRF token with applications consuming the API.</p>

<h3 id="working-with-mfa">Working with MFA</h3>

<p>Passbolt Pro Edition currently supports logging in using multi factor authentication. Your script will need to cater for these scenarios, if the account you are using has MFA enabled.</p>

                        </div>

                    <div class="col4 last push1" markdown="1">
                        
                    </div>
                    </div>

                    
                    <div class="row" markdown="1">
                        <div class="col7" markdown="1">
                            <ul>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
</ul>

                        </div>

                    <div class="col4 last push1" markdown="1">
                    </div>

                    </div>

                    </div>
                    

                </article>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
</div>
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//passbolt.piwikpro.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//passbolt.piwikpro.com//piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>
</html>
