<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Install passbolt from scratch on Debian 9 (Stretch)</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         © 2018 Passbolt SARL

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Install passbolt from scratch on Debian 9 (Stretch)" />
    <meta property="og:description" content="" />

    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="canonical" href="https://help.passbolt.com/hosting/install/ce/debian-9-stretch">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">

</head>
<body>
<div id="container" class="help page background">
    <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" target="_blank" rel="noopener"><span>demo</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="//help.passbolt.com/"><span>help</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/2018-04-18-hosting-install-source-ce-v2-debian-9.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>
    <div class="panel main" aria-label="Content">
        <div class="panel left">
            
            





<div class="navigation wizard" role="navigation">
    <ul>
        <li><h2>Hosting</h2></li>
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting">Hosting FAQ</a>
        </li>
        
        
        <li class="selected">
            <a href="https://help.passbolt.com/hosting/install">Installation</a>
        </li>
        
            
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/update">Update</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/upgrade">Upgrade</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/backup">Backup</a>
        </li>
        
        
        <li >
            <a href="https://community.passbolt.com/c/installation-issues">Installation issues</a>
        </li>
        
        
    </ul>
</div>






            
        </div>
        <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
            <div class="grid grid-responsive-12">
                <article>
                    <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting"><span>hosting</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/install"><span>install</span></a>
                    </div>
                </li>
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/install/ce/debian-9-stretch.html"><span>from-source</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                    <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Install passbolt from scratch on Debian 9 (Stretch)</h1>
</div>
</div>

                    <div class="row">
  <div class="col7">

    <h2 id="system-requirements">System requirements</h2>

    <p>Spin up a new fresh server with Debian 9 (Stretch). Make sure that it is up-to-date.</p>

    <h2 id="installation-steps">Installation steps</h2>

    <h3 id="base-packages">1. Base packages</h3>
    <p>No need to install any particular package such as the webserver (apache) during the setup. Let’s stick to the bare minimum for now, as we will do the rest manually.</p>

    <p>Since we will need administrator privileges to perform most of the steps, you could either setup sudo for your default user, or log in the terminal as root.</p>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>bash
</code></pre></div>    </div>

    <p>We can install some basic utilities: Git, composer, unzip, make, the linux kernel headers and a compiler, as will all be needed later on.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt-get <span class="nb">install </span>make git-core composer unzip g++ linux-headers-amd64 <span class="nt">-y</span>
</code></pre></div>    </div>

    <h3 id="database-installation">2. Database installation</h3>
    <p>Then, we can install the database server. We will use mariadb here, but you could also use mysql.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt-get <span class="nb">install </span>mariadb-server <span class="nt">-y</span>
</code></pre></div>    </div>

    <p>Let’s make sure that the database is started</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl start mariadb
</code></pre></div>    </div>

    <p>By default, MariaDB / MySQL is installed with basic security, and no root password. Let’s fix this.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysql_secure_installation
</code></pre></div>    </div>

    <p>Answer the questions and set a strong root password for the db.</p>

    <p>Let’s now create a specific passbolt user and database.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mysql <span class="nt">-u</span> root <span class="nt">-p</span>
mysql <span class="o">&gt;</span> create database passbolt<span class="p">;</span>
mysql <span class="o">&gt;</span> create user passbolt<span class="p">;</span>
mysql <span class="o">&gt;</span> grant all on passbolt.<span class="k">*</span> to <span class="s1">'passbolt'</span>@<span class="s1">'localhost'</span> identified by <span class="s1">'strong_db_password'</span><span class="p">;</span>
mysql <span class="o">&gt;</span> flush privileges<span class="p">;</span>
mysql <span class="o">&gt;</span> quit<span class="p">;</span>
</code></pre></div>    </div>

    <h3 id="webserver-installation-apache2">3. Webserver installation (apache2)</h3>
    <p>Next we will want to install the apache webserver that will serve our php application.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt-get <span class="nb">install </span>apache2 <span class="nt">-y</span>
</code></pre></div>    </div>

    <p>Passbolt needs the mod_rewrite module to function properly.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>a2enmod rewrite
</code></pre></div>    </div>

    <p>We can see if this worked by opening up the web browser and going to the url: http://localhost (or whatever hostname / ip used by your machine). 
By default apache stores the web pages in /var/www/html so we can see and edit the default html page in this directory if needed.</p>

    <h3 id="php-installation">4. PHP installation</h3>
    <p>Now let’s install php 7 and its dependencies. By default the command line interface (php5-cli) and the apache mod for php (libapache2-mod-php5) will be also installed as dependencies. We will need them later on.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt-get <span class="nb">install </span>php7.0 php7.0-cli php7.0-common libapache2-mod-php7.0 php7.0-json php7.0-readline php7.0-mysqlnd libonig4 libqdbm14 <span class="nt">-y</span>
</code></pre></div>    </div>

    <p>Passbolt needs some extra dependencies to run properly:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt-get <span class="nb">install </span>php7.0-gd php7.0-intl php7.0-simplexml php7.0-curl php7.0-dom php7.0-mbstring <span class="nt">-y</span>
</code></pre></div>    </div>

    <p>Passbolt needs GnuPG and it corresponding php module to run.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>apt-get <span class="nb">install </span>libgpgme11-dev php7.0-gnupg <span class="nt">-y</span>
</code></pre></div>    </div>

    <p>You will need to restart your apache server for the changes to take place.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl restart apache2
</code></pre></div>    </div>

    <h3 id="virtual-host-config">5. Virtual host config</h3>
    <p>For apache to work with passbolt we need to edit the virtual host configuration file to add the passbolt folder and rewrite rules.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nano /etc/apache2/sites-enabled/000-default.conf
</code></pre></div>    </div>

    <p>This is what a minimal configuration without ssl looks like (we’ll get to the ssl part later). Of course you will need to replace your administrator email address (ServerAdmin setting) and server name (ServerName setting).</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    ServerName passbolt.dev

    DocumentRoot /var/www/passbolt

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    &lt;Directory /var/www/passbolt&gt;
        Options FollowSymLinks
        AllowOverride All
        Require all granted
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre></div>    </div>
    <h3 id="domain-name-setup">6. Domain name setup</h3>
    <p>For the sake of keeping this demonstration short we will use passbolt.dev as domain name
(we added the IP to domain name mapping with a manual entry in the /etc/hosts file after a quick lookup on ifconfig).</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nano /etc/hosts
</code></pre></div>    </div>

    <p>Add this line to the file</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1 passbolt.dev
</code></pre></div>    </div>

    <p>Of course, replace 127.0.0.1 by whichever ip is used by your host.</p>

    <h3 id="download-passbolt">7. Download passbolt</h3>
    <p>In the web server configuration file, we are pointing to <code class="highlighter-rouge">/var/www/passbolt</code> but obviously it does not exist yet! 
Let’s create it, by cloning passbolt official repository. This way we can pull new releases easily in the future.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /var/www
<span class="nv">$ </span>git clone https://github.com/passbolt/passbolt_api.git ./passbolt
</code></pre></div>    </div>

    <h3 id="generate-an-openpgp-key">8. Generate an OpenPGP key</h3>
    <p>Passbolt API uses an OpenPGP key for the server in order to authenticate and sign the outgoing JSON requests.</p>

    <div class="message warning">
    <p>
        <strong>Note:</strong> Running gpg –gen-key on a virtual machine can take a while because /dev/random does not have enough “randomness” aka entropy. You can speed up the gpg key creation with the <strong>haveged</strong> package to improve the entropy generation :

    </p>
    
</div>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Only in case of container or VM</span>
<span class="nv">$ </span>apt-get <span class="nb">install </span>haveged <span class="nt">-y</span>
<span class="nv">$ </span>systemctl start haveged
</code></pre></div>    </div>

    <p>Now generate an OpenPGP key</p>

    <p><strong>Important: Currently php-gnupg does not support keys with a passphrase so you will need to leave that field empty.</strong></p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gpg <span class="nt">--gen-key</span>
</code></pre></div>    </div>

    <p><strong>Note:</strong> if you do not run this command as <code class="highlighter-rouge">www-data</code> the result will be stored in <code class="highlighter-rouge">/root/.gnupg</code>. Thankfully passbolt does import the keys at runtime into the <code class="highlighter-rouge">www-data</code> keyring if it is not already present.</p>

    <p>It’s a good idea to fill in the details properly and not press enter frantically. Make sure you have decent name and email for the key. This will come in handy to identify and verify it down the line.</p>

    <p>After creating the key <strong>make sure you note down the fingerprint</strong>, it will be requested later in the install process.
You can get the server key fingerprint as follows:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gpg <span class="nt">--list-keys</span> <span class="nt">--fingerprint</span> | <span class="nb">grep</span> <span class="nt">-i</span> <span class="nt">-B</span> 2 <span class="s1">'SERVER_KEY@EMAIL.TEST'</span>
pub   2048R/28EEB539 2018-04-18
      Key fingerprint <span class="o">=</span> 480E 9564 0F27 6562 39D6  7BF5 8AB6 8641 28EE B539
uid                  firstname lastname &lt;SERVER_KEY@EMAIL.TEST&gt;
</code></pre></div>    </div>

    <p>Copy the public and private keys to the passbolt config location:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gpg <span class="nt">--armor</span> <span class="nt">--export-secret-keys</span> SERVER_KEY@EMAIL.TEST <span class="o">&gt;</span> /var/www/passbolt/config/gpg/serverkey_private.asc
<span class="nv">$ </span>gpg <span class="nt">--armor</span> <span class="nt">--export</span> SERVER_KEY@EMAIL.TEST <span class="o">&gt;</span> /var/www/passbolt/config/gpg/serverkey.asc
</code></pre></div>    </div>

    <p>We don’t want those keys to be readable by anyone, except the webserver.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">chmod </span>640 /var/www/passbolt/config/gpg/serverkey<span class="k">*</span>
</code></pre></div>    </div>

    <h3 id="initialize-the-webserver-gpg-keyring">9. Initialize the webserver gpg keyring</h3>
    <p>In order for passbolt authentication to work your server key needs to be in the keyring used by the web server.
It is likely that there is none, so you can create one by interacting with gpg with the web server user</p>

    <p>In debian 9, the home directory of the web server user www-data is /var/www.</p>

    <p>We need to give ownership of this folder to www-data , since it is not there by default.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">chown </span>www-data:www-data /var/www
</code></pre></div>    </div>

    <p>We create the keyring for the webserver:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>su <span class="nt">-s</span> /bin/bash <span class="nt">-c</span> <span class="s2">"gpg --list-keys"</span> www-data
gpg: directory <span class="s1">'/var/www/.gnupg'</span> created
gpg: keybox <span class="s1">'/var/www/.gnupg/pubring.kbx'</span> created
gpg: /var/www/.gnupg/trustdb.gpg: trustdb created
</code></pre></div>    </div>

    <h3 id="set-passbolt-file-permissions">9. Set passbolt file permissions</h3>
    <p>We need to set the right permissions on the passbolt files. It should belong to the same owner as the webserver.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">chown</span> <span class="nt">-R</span>  www-data:www-data /var/www/passbolt
<span class="nv">$ </span><span class="nb">cd</span> /var/www/passbolt
</code></pre></div>    </div>

    <p><strong>Important:</strong> For the following steps, we’ll also need to use the same user as the one running the webserver. In our case (apache), it is www-data.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>su <span class="nt">-s</span> /bin/bash www-data
</code></pre></div>    </div>

    <h3 id="install-the-dependencies">10. Install the dependencies</h3>
    <p>The project dependencies such as the plugin to manage the images, emails, etc. are not included anymore
in the code on the official repository. Fret not, composer will manage this for us.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>composer <span class="nb">install</span>
</code></pre></div>    </div>

    <h3 id="create-a-passbolt-configuration-file">11. Create a passbolt configuration file</h3>
    <p>Everything is located in one configuration file called <code class="highlighter-rouge">config/passbolt.php</code>.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp </span>config/passbolt.default.php config/passbolt.php
<span class="nv">$ </span>nano config/passbolt.php
</code></pre></div>    </div>

    <p>You will need to set at least the following:</p>
    <ul>
      <li>Application full base url</li>
      <li>Database configuration</li>
      <li>Server OpenPGP key fingerprint (you noted it down before)</li>
    </ul>

    <p>Ignore the email configuration for now. We will take care of it later.</p>

    <p>For now, we will also deactivate the force_ssl parameter for the sake of having a functional passbolt
quickly. We’ll activate ssl later.</p>

    <p>The sections of your configuration file should look similar to this:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
    'App' =&gt; [
        'fullBaseUrl' =&gt; 'http://passbolt.dev',
    ],

    // Database configuration.
    'Datasources' =&gt; [
        'default' =&gt; [
            'host' =&gt; 'localhost',
            'username' =&gt; 'passbolt',
            'password' =&gt; 'your_password',
            'database' =&gt; 'passbolt',
        ],
    ],
    'passbolt' =&gt; [
        'ssl' =&gt; [
            'force' =&gt; false,
        ],
        'gpg' =&gt; [ 
            // Main server key.
            'serverKey' =&gt; [
                // Server private key fingerprint.
                'fingerprint' =&gt; '1C765F5273EC9AF56300BC6F6C76DA6B9F23C8BB',
                //'public' =&gt; CONFIG . 'gpg' . DS . 'serverkey.asc',
                //'private' =&gt; CONFIG . 'gpg' . DS . 'serverkey_private.asc',
            ],
        ],
    ],
]
</code></pre></div>    </div>

    <p>For now, do not forget to add <code class="highlighter-rouge">ssl.force =&gt; false</code> as seen above, or passbolt will redirect all your connections to a https socket, which will not work since it is not yet configured.</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'ssl' =&gt; [
    'force' =&gt; false,
],
</code></pre></div>    </div>

    <p>You can also set your configuration using environment variables.
Check <code class="highlighter-rouge">config/default.php</code> to get the names of the environment variables.</p>

    <h3 id="run-the-install-script">12. Run the install script</h3>
    <p>Let’s install passbolt tables and data in the database.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./bin/cake passbolt <span class="nb">install</span>
</code></pre></div>    </div>

    <p>The install script will ask you to create an admin user. Enter your first name, last name and email. In return, the script will
provide you with an activation link that you will user later to activate and configure your user. You can go to this url now or later, but we
recommend that you configure SSL before.</p>

    <p>Optionally you can also run the health check to see if everything is fine.</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./bin/cake passbolt healthcheck
</code></pre></div>    </div>

    <p>You should see a majority of green ok. However, some SSL related alerts should still appear.</p>

    <h3 id="its-running">13. It’s running</h3>
    <p>At this stage, passbolt is running as it should, but https is still missing. It is strongly recommended
that you configure https before using passbolt. We will go through it in the next section, as well as the emails configuration.</p>

    <h2 id="going-further">Going further</h2>

    <h3 id="setup-the-emails">1. Setup the emails</h3>
    <p>For passbolt to be able to send emails, you must first configure properly the “EmailTransport” and “Email” section in the 
<code class="highlighter-rouge">config/passbolt.php</code> file to match your provider smtp details.</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Email configuration.
    'EmailTransport' =&gt; [
        'default' =&gt; [
            'host' =&gt; 'localhost',
            'port' =&gt; 25,
            'username' =&gt; 'user',
            'password' =&gt; 'password',
            // Is this a secure connection? true if yes, null if no.
            'tls' =&gt; null,
            //'timeout' =&gt; 30,
            //'client' =&gt; null,
            //'url' =&gt; null,
        ],
    ],
    'Email' =&gt; [
        'default' =&gt; [
            // Defines the default name and email of the sender of the emails.
            'from' =&gt; ['passbolt@your_organization.com' =&gt; 'Passbolt'],
            //'charset' =&gt; 'utf-8',
            //'headerCharset' =&gt; 'utf-8',
        ],
    ],
</code></pre></div>    </div>

    <p>To send a test email and debug your smtp settings, you can use the following command:</p>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./bin/cake passbolt send_test_email
</code></pre></div>    </div>

    <p>When an email is sent, it is first placed in a queue that needs to be processed by the following shell.</p>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./bin/cake EmailQueue.sender
</code></pre></div>    </div>

    <p>In order to have your emails sent automatically, you can add a cron call to the script so the emails will be sent every minute. 
Add the following line to you crontab:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> su <span class="nt">-c</span> <span class="s2">"/var/www/passbolt/bin/cake EmailQueue.sender &gt;&gt; /var/log/passbolt.log"</span> <span class="nt">-s</span> /bin/bash www-data
</code></pre></div>    </div>

    <h3 id="configure-https">2. Configure https</h3>
    <p>It is recommended to use https with passbolt (and, well, pretty much <a href="https://www.eff.org/encrypt-the-web">everything</a>). 
To setup SSL we need a certificate. Here for the sake of brevity we will create a self-signed certificate. 
Of course you are free to use a <a href="https://letsencrypt.org/getting-started/">proper free certificate</a> and tidy up the server supported cypher suites.</p>

    <p>In the following steps, we’ll generate a self signed certificate and configure apache and passbolt to use https.</p>

    <p><strong>a. Generate the self signed certificate</strong></p>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openssl req <span class="nt">-new</span> <span class="nt">-newkey</span> rsa:4096 <span class="nt">-days</span> 365 <span class="nt">-nodes</span> <span class="nt">-x509</span> <span class="nt">-subj</span> <span class="s2">"/C=FR/ST=Denial/L=Springfield/O=Dis/CN=passbolt.dev"</span> <span class="nt">-keyout</span> /etc/ssl/certs/passbolt.key <span class="nt">-out</span> /etc/ssl/certs/passbolt.crt

Generating a 4096 bit RSA private key
................++
...++
writing new private key to <span class="s1">'/etc/ssl/certs/passbolt.key'</span>
<span class="nt">-----</span>
</code></pre></div>    </div>

    <p><strong>b. Make sure the certificate is readable by apache</strong></p>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">chown </span>root:www-data /etc/ssl/certs/passbolt.crt
<span class="nv">$ </span><span class="nb">chown </span>root:www-data /etc/ssl/certs/passbolt.key
<span class="nv">$ </span><span class="nb">chmod </span>640 /etc/ssl/certs/passbolt.crt
<span class="nv">$ </span><span class="nb">chmod </span>640 /etc/ssl/certs/passbolt.key
</code></pre></div>    </div>

    <p><strong>Enable SSL apache module and site</strong></p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>a2enmod ssl
<span class="nv">$ </span>a2enmod headers
<span class="nv">$ </span>a2ensite default-ssl
</code></pre></div>    </div>

    <p><strong>c. Configure virtual host</strong></p>

    <p>Let’s add the rewrite and SSL rules and certificates.</p>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nano /etc/apache2/sites-enabled/default-ssl.conf
</code></pre></div>    </div>

    <p>Your file should look like this:</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;IfModule mod_ssl.c&gt;
    &lt;VirtualHost _default_:443&gt;
        ServerAdmin webmaster@localhost
        ServerName passbolt.dev

        DocumentRoot /var/www/passbolt

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        SSLEngine on
        SSLCertificateFile /etc/ssl/certs/passbolt.crt
        SSLCertificateKeyFile /etc/ssl/certs/passbolt.key
 
        &lt;Directory /var/www/passbolt&gt;
            Options FollowSymLinks
            AllowOverride All
            Require all granted
        &lt;/Directory&gt;
    
        &lt;FilesMatch “\.(php)$”&gt;
            SSLOptions +StdEnvVars
        &lt;/FilesMatch&gt;

        BrowserMatch “MSIE [2–6]” \
          nokeepalive ssl-unclean-shutdown \
          downgrade-1.0 force-response-1.0
        BrowserMatch “MSIE [17–9]” ssl-unclean-shutdown

    &lt;/VirtualHost&gt;
&lt;/IfModule&gt;
</code></pre></div>    </div>

    <p><strong>d. Restart Apache</strong></p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl reload apache2
</code></pre></div>    </div>

    <p><strong>e. Force SSL in passbolt configuration</strong>
We’ll need to change the passbolt configuration to make him use https instead of http,
and force the redirection to https:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nano /var/www/passbolt/config/passbolt.php
</code></pre></div>    </div>

    <p>Set fullBaseUrl to https</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'App' =&gt; [
    'fullBaseUrl' =&gt; 'https://passbolt.dev',
],
</code></pre></div>    </div>

    <p>Set ssl.force config parameter to true, instead of false. You can also remove the line as it will be set to true by default.</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'ssl' =&gt; [
    'force' =&gt; true,
],
</code></pre></div>    </div>

    <p>That’s it! Passbolt is now ready to be used with https.</p>

    <p>If you have already done the setup of your user, you will notice that passbolt tells you that the plugin is not configured to work with this domain. This is normal since it was already configured to work with http, and not https.</p>

    <p>That’s not an issue, you can fix this easily by clicking on “recover an existing account”</p>

    <h2 id="thats-it">That’s it</h2>
    <p>Do let us know if you run into problems following this tutorial on the <a href="support forum">https://community.passbolt.com/c/installation-issues</a>.</p>

    <p>Thank you for trying out Passbolt CE!</p>

    <h3 id="troubleshooting">Troubleshooting</h3>

    <p>Here are some frequently asked questions related to passbolt installation:</p>
    <ul>
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
    
    
    
        
            
                
    <li>
        <a href="/faq/hosting/why-unsafe">Why do I see an unsafe mode banner in the footer?</a>
    </li>
                
            
        
    
    
    
        
            
                
    <li>
        <a href="/faq/hosting/why-email-not-sent">Why are my emails not being sent?</a>
    </li>
                
            
        
    
    
    
        
    
    
    
    
    
        
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
</ul>

    <p>Feel free to ask for help on the <a href="https://community.passbolt.com/c/installation-issues">community forum</a>.</p>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
April
9th,
2018.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues when installing passbolt?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Ask the community!</a>
    
</div>

    <div class="message tldr">
    <p>Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!</p>
    
    <a href="https://www.github.com/passbolt/passbolt_help" class="button ">View on github</a>
    
</div>

    <div class="message tldr notice">
    <p><strong>Don't want the hassle of a manual installation?</strong> Passbolt Pro comes with out of the box install scripts and a ready-to-use VM.</p>
    <a href="https://www.passbolt.com/pricing/pro" class="button primary">Get Passbolt Pro</a>

</div>

  </div>
</div>

                </article>
            </div>
        </div>
    </div>
    <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
            </ul>
        </div>
    </footer>
</div>
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//passbolt.piwikpro.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//passbolt.piwikpro.com//piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>
</html>
