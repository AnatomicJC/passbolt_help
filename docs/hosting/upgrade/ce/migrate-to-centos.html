<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Passbolt Help | Migrate passbolt CE from install scripts to CentOS 7 package</title>
    <!--
             ____                  __          ____
            / __ \____  _____ ____/ /_  ____  / / /_
           / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
          / ____/ /_/ (__  |__  ) /_/ / /_/ / / /_
         /_/    \__,_/____/____/_.___/\____/_/\__/

         Open source password manager for teams
         © 2019 Passbolt SA

     -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta property="og:image" content="https://help.passbolt.com/assets/img/background/og_preview.jpg" />
    <meta property="og:title" content="Migrate passbolt CE from install scripts to CentOS 7 package" />
    <meta property="og:description" content="" />
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/help.min.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/highlight.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/cookie-eu-banner.css">
    <link rel="stylesheet" href="https://help.passbolt.com/assets/css/custom.css">
    <link rel="canonical" href="https://help.passbolt.com/hosting/upgrade/ce/migrate-to-centos">
    <link rel="shortcut icon" type="image/x-icon" href="https://help.passbolt.com/assets/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Passbolt | Help" href="https://help.passbolt.com/feed.xml">
</head>


<body>
    <div id="container" class="help page background">
            <header>
        <div class="header first ">
            <nav class="greedy">
                <div class="top navigation primary">
                    <ul class="links clearfix">
                        <li class="home with-text"><a href="http://www.passbolt.com/"><span>home</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/services"><span>pricing</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/roadmap"><span>roadmap</span></a></li>
                        <li class="left"><a href="https://community.passbolt.com/"><span>forum</span></a></li>
                        <li class="left"><a href="https://www.passbolt.com/blog"><span>blog</span></a></li>
                        <li class="left selected"><a href="https://help.passbolt.com/"><span>help</span></a></li>
                        <li class="left"><a href="https://demo.passbolt.com" class="highlighted" target="_blank" rel="noopener"><span>try it!</span></a></li>
                    </ul>
                    <button class="hidden" count="0">more</button>
                    <ul class="hidden-links hidden"></ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="header second">
        <div class="col1">
            <div class="logo no-img">
                <h1><span>Passbolt</span></h1>
            </div>
        </div>
        <div class="col2 search-wrapper">
            <h2 class="visuallyhidden">Help Search</h2>
            <div>
                <form class="search ready" action="/search.html" method="get">
                    <div class="input required">
                        <label for="search-box">Search</label>
                        <input id="search-box" name="query" maxlength="64" placeholder="Help search" class="fuzzy-search" type="search">
                    </div>
                    <button value="search">
                        <i class="fa fa-fw fa-search"></i>
                        <span class="text visuallyhidden">search</span>
                    </button>
                </form>
            </div>
        </div>
        <div class="col3">
            <div class="edit-on-github">
                <a href="https://github.com/passbolt/passbolt_help/edit/master/_posts/hosting/upgrade/2021-11-26-migrate-to-centos-package.md" class="button">
                    <i class="fa fa-github-alt fa-fw"></i> Edit on github</a>
            </div>
        </div>
    </div>

        <div class="panel main" aria-label="Content">
            <div class="panel left">
                
                







<div class="navigation-help" role="navigation">
    <ul>
        <li>
            <h2>Hosting</h2>
        </li>
        
        <li >
            <a href="https://help.passbolt.com/faq/hosting">Hosting FAQ</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/install">Installation</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/update">Update</a>
        </li>
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/upgrade">Upgrade</a>
        </li>
        
        
        
        
        <li >
            <a href="https://help.passbolt.com/hosting/backup">Backup</a>
        </li>
        
        
        <li >
            <a href="https://community.passbolt.com/c/installation-issues">Installation issues</a>
        </li>
        
        
    </ul>
</div>










                
            </div>
            <div class="panel middle" data-spy="scroll" data-target=".scrollspy">
                <div class="grid grid-responsive-12">
                    <article>
                        <div class="row" id="introduction">
    <div class="col12">
        <div class="breadcrumbs">
            <ul>
                <li>
                    <div class="main-cell">
                        <a href="https://www.passbolt.com"><span>home</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="/"><span>help</span></a>
                    </div>
                </li>
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting"><span>hosting</span></a>
                    </div>
                </li>
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade"><span>upgrade</span></a>
                    </div>
                </li>
                
                
                
                <li>
                    <div class="main-cell">
                        <a href="https://help.passbolt.com/hosting/upgrade/ce/migrate-to-centos.html"><span>migrate-to-centos</span></a>
                    </div>
                </li>
                
            </ul>
        </div>
    </div>
</div>

                        <div class="row" markdown="1">
<div class="col7" markdown="1">
<h1>Migrate passbolt CE from install scripts to CentOS 7 package</h1>
</div>
</div>

                        
<div class="row">
  <div class="col7">

    <p>A CentOS package has been created to increase the ease of installing and upgrading passbolt.</p>

    <h2 id="pre-requisites">Pre-requisites</h2>

    <p>For this tutorial, you will need:</p>
    <ul>
      <li>A minimal CentOS 7 server.</li>
      <li>Passbolt installed with the CentOS install script.</li>
    </ul>

    <h2 id="take-down-your-site">1. Take down your site</h2>

    <p>It is generally a good idea to stop running the site prior to the upgrade. This is to avoid having side effects
such as active users corrupting the data in the middle of an upgrade.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl stop nginx
</code></pre></div>    </div>

    <h2 id="backup-your-instance">2. Backup your instance</h2>

    <p>First things first, as this is a sensitive operation a backup of the instance must be performed to prevent any data loss.
You can follow our <a href="/hosting/backup">backup process</a>.</p>

    <h2 id="upgrade-your-system">3. Upgrade your system</h2>

    <p>Passbolt requires PHP 7.3 and supports PHP 7.4.</p>

    <p>A full system upgrade to CentOS 7 is necessary before installing the passbolt CentOS package.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum upgrade
</code></pre></div>    </div>

    <h2 id="install-the-package">4. Install the package</h2>

    <h2 id="install-the-server-components">1. Install the server components</h2>
    <h3 id="package-repository-setup">1.1. Package repository setup</h3>

    <p>For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt CE and install it.</p>

    <p>These steps assume you have already installed sudo and added your user to the sudo group.</p>

    <p><strong>Step 1.</strong> Configure Extra Packages for Enterprise Linux (EPEL) repository</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install epel-release
</code></pre></div>    </div>

    <p>While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on <a href="https://getfedora.org/security/">this reference page</a>.</p>

    <p><strong>Step 2.</strong> Configure Remi’s RPM repository</p>

    <p>As CentOS 7 don’t provide the mandatory <strong>php-pecl-gnupg</strong> package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.</p>

    <p>Install Remi repository configuration package.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install https://rpms.remirepo.net/enterprise/remi-release-7.rpm
</code></pre></div>    </div>

    <p>During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches <a href="https://blog.remirepo.net/pages/Config-en">with the one on the bottom of this reference page</a>.</p>

    <p>Install the <code class="language-plaintext highlighter-rouge">yum-utils</code> package:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install yum-utils
</code></pre></div>    </div>

    <p><strong>Step 3.</strong> Enable the module stream for PHP 7.4:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum-config-manager --disable 'remi-php*'
sudo yum-config-manager --enable   remi-php74
</code></pre></div>    </div>

    <p><strong>Step 4.</strong> Let’s Encrypt</p>

    <p>Install certbot if you plan to manage your SSL certificates with <a href="https://letsencrypt.org/">Let’s Encrypt</a>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install certbot python3-certbot-nginx
</code></pre></div>    </div>

    <p><strong>Step 5.</strong> Setup MariaDB 10.3 repository</p>

    <p>CentOS 7 comes with an outated MariaDB 5.x version and performance issues has been reported by using it. That’s why you should consider to upgrade MariaDB to version 10.3.</p>

    <p>Add MariaDB 10.3 repository:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &lt;&lt; EOF | sudo tee /etc/yum.repos.d/mariadb.repo
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.3/centos7-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
EOF
</code></pre></div>    </div>

    <p>Upgrade MariaDB server from 5.5.xx to 10.3 version:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install MariaDB-server MariaDB-client
</code></pre></div>    </div>

    <p>At this step, MariaDB 5.5 has been replaced with MariaDB 10.3. You can now restart the MariaDB service:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl restart mariadb.service
</code></pre></div>    </div>

    <p>Run this command to upgrade MariaDB internal database schemas:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo su -s /bin/bash -c "mysql_upgrade -p" mysql
</code></pre></div>    </div>

    <p>You will be prompted with root mysql password and an output like the one below will be displayed:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Phase 1/7: Checking and upgrading mysql database
Processing databases
mysql
mysql.columns_priv OK
mysql.db OK
mysql.event OK
(etc etc...)
</code></pre></div>    </div>

    <p>At this step, MariaDB has been upgraded.</p>

    <p><strong>Step 6.</strong>  Add passbolt repository:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &lt;&lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/ce/rpm/el7/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
</code></pre></div>    </div>

    <h4 id="install-passbolt-package">Install passbolt package</h4>

    <p>Install the main passbolt server component:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install passbolt-ce-server
</code></pre></div>    </div>

    <p>During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Importing GPG key 0xC155581D:
 Userid     : "Passbolt SA package signing key &lt;contact@passbolt.com&gt;"
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
</code></pre></div>    </div>

    <h2 id="copy-existing-configuration-to-the-new-location">5. Copy existing configuration to the new location</h2>

    <h3 id="copy-the-server-keys">5.1. Copy the server keys</h3>

    <p>Copy the GPG server keys as following:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp</span> <span class="nt">-a</span> /var/www/passbolt/config/gpg/<span class="k">*</span> /etc/passbolt/gpg/
<span class="nb">sudo chown</span> <span class="nt">-R</span> root:www-data /etc/passbolt/gpg
<span class="nb">sudo chmod </span>g-w /etc/passbolt/gpg
</code></pre></div>    </div>

    <h3 id="copy-the-passbolt-configuration">5.2. Copy the passbolt configuration</h3>

    <p>Copy passbolt configuration as following:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp</span> /var/www/passbolt/config/passbolt.php /etc/passbolt/passbolt.php
<span class="nb">sudo chown </span>root:www-data /etc/passbolt/passbolt.php
<span class="nb">sudo chmod </span>g-w /etc/passbolt/passbolt.php
</code></pre></div>    </div>

    <p>If you are running mysql 8, please change the <code class="language-plaintext highlighter-rouge">quoteIdentifiers</code> setting of the passbolt.php as follow:</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'quoteIdentifiers'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
</code></pre></div>    </div>

    <h2 id="php-fpm">6. PHP-FPM</h2>

    <p>Edit <code class="language-plaintext highlighter-rouge">/etc/php/7.3/fpm/pool.d/www.conf</code> and look for the line that looks like this:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listen <span class="o">=</span> 127.0.0.1:9000
</code></pre></div>    </div>

    <p>Change it to look like this:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listen <span class="o">=</span> /run/php/php7.3-fpm.sock
</code></pre></div>    </div>

    <p>Due to a bug on the install scripts some installations might need to do an additional substitution on <code class="language-plaintext highlighter-rouge">/etc/php/7.3/fpm/pool.d/www.conf</code>:</p>

    <p>Look for the line containing:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listen.group <span class="o">=</span> _WWW_GROUP_
</code></pre></div>    </div>

    <p>And change it to look like:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listen.group <span class="o">=</span> www-data
</code></pre></div>    </div>

    <h2 id="nginx">7. Nginx</h2>
    <div class="message notice">
    <p>
    Note to users with Apache installed instead: make sure
    to transfer over the .htaccess file from the old webroot folder.
    </p>
    
</div>

    <p>Now you can remove all the old nginx configuration files from <code class="language-plaintext highlighter-rouge">/etc/nginx/conf.d/</code></p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo rm</span> /etc/nginx/conf.d/passbolt.conf
<span class="nb">sudo rm</span> /etc/nginx/conf.d/passbolt_ssl.conf
</code></pre></div>    </div>
    <p>Then you can reconfigure the CentOS package using:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /usr/local/bin/passbolt-configure
</code></pre></div>    </div>

    <p>Answer the following way:</p>

    <ul>
      <li><strong>No</strong> to mysql configuration</li>
      <li><strong>Yes</strong> to nginx configuration</li>
    </ul>

    <p>You can then select the SSL method that suits best your needs.</p>

    <h2 id="run-the-database-migrations">8. Run the database migrations</h2>

    <p>Now it is time to run the migrations to upgrade the database schemas:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-H</span> <span class="nt">-u</span> www-data bash <span class="nt">-c</span> <span class="s2">"/usr/share/php/passbolt/bin/cake passbolt migrate"</span>
</code></pre></div>    </div>

    <h2 id="cleanup">9. Cleanup</h2>

    <p>After you have checked you can access your new setup with the CentOS package make a backup of <code class="language-plaintext highlighter-rouge">/var/www/passbolt</code> and then
you can delete it:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo rm</span> <span class="nt">-rf</span> /var/www/passbolt
</code></pre></div>    </div>

    <p>You may also want to check for the old CRON job that may need to be removed:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>crontab <span class="nt">-u</span> www-data <span class="nt">-e</span>
</code></pre></div>    </div>

    <h2 id="take-your-site-back-up">10. Take your site back up</h2>

    <p>Finally take passbolt back up:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl start nginx
<span class="nb">sudo </span>systemctl restart php7.3-fpm
</code></pre></div>    </div>

    <div class="last-updated">
      <h3>Last updated</h3>
      <p>This article was last updated on 
November
26th,
2021.</p>
    </div>

  </div>
  <div class="col4 last push1">

    <div class="message tldr notice">
    <p>Are you experiencing issues when updating passbolt?</p>
    
    <a href="https://community.passbolt.com/c/installation-issues" class="button primary">Ask the community!</a>
    
</div>

    <div class="message ">
    <p></p>
    
</div>

    <div class="message tldr">
    <p>Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!</p>
    
    <a href="https://www.github.com/passbolt/passbolt_help" class="button ">View on github</a>
    
</div>

  </div>
</div>

                    </article>
                </div>
            </div>
        </div>
            <footer>
        <div class="footer">
            <ul class="footer-links">
                <li><a href="https://www.passbolt.com/licence">Terms</a></li>
                <li><a href="https://www.passbolt.com/privacy">Privacy</a></li>
                <li><a href="https://www.passbolt.com/credits">Credits</a></li>
                <li><a href="https://careers.passbolt.com">Careers</a></li>
            </ul>
        </div>
    </footer>
    <div id="cookies-eu-banner" class="visually-hidden">
        🍪 &nbsp; Do you accept cookies for statistical purposes?
        <a href="https://www.passbolt.com/privacy" id="cookies-eu-more">(Read more)</a>
        <a class="button primary" id="cookies-eu-accept">Accept</a>
        <a id="cookies-eu-reject">No thanks!</a>
    </div>


    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23506466-3"></script>
<script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"></script>
<script src="https://help.passbolt.com/assets/js/cookies-eu-banner.js"></script>
<script src="https://help.passbolt.com/assets/js/analytics.js"></script>
<script src="https://help.passbolt.com/assets/js/greedynav.js"></script>
</body>

</html>