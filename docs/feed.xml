<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.1">Jekyll</generator><link href="https://help.passbolt.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://help.passbolt.com/" rel="alternate" type="text/html" /><updated>2021-10-27T13:54:29+02:00</updated><id>https://help.passbolt.com/feed.xml</id><title type="html">Passbolt | Help</title><subtitle>The help site for passbolt, the open source password manager for teams. This site contains frequently asked questions, article to troubleshoot common issues, installation tutorials, blueprints for developers, and more!</subtitle><entry><title type="html">Most common ldap sync error messages</title><link href="https://help.passbolt.com/configure/ldap/ldap-common-sync-error-messages.html" rel="alternate" type="text/html" title="Most common ldap sync error messages" /><published>2021-10-11T02:00:00+02:00</published><updated>2021-10-11T02:00:00+02:00</updated><id>https://help.passbolt.com/configure/ldap/ldap-common-sync-error-messages</id><content type="html" xml:base="https://help.passbolt.com/configure/ldap/ldap-common-sync-error-messages.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

    &lt;p&gt;Depending on the structure of your directory or the state of the synchronization between passbolt and your directory, passbolt can report certain synchronization issues. 
They come from a variety of reasons, here are the most common ones.&lt;/p&gt;

    &lt;h3 id=&quot;the-user-userdomaincom-could-not-be-added-to-group-mygroup-because-it-is-not-active-yet&quot;&gt;The user user@domain.com could not be added to group MyGroup because it is not active yet&lt;/h3&gt;
    &lt;p&gt;This error happens when passbolt is trying to add a user to a group, but the user has not yet activated their account. Passbolt
cannot add such users to groups automatically since their account is not operational yet. 
When this situation happens, no intervention is required. The user will be added to the group automatically once they activate their account (when they click on the link provided in the email invitation and complete the initial setup).&lt;/p&gt;

    &lt;h3 id=&quot;the-user-userdomaincom-could-not-be-mapped-with-an-existing-user-in-passbolt-because-it-was-created-after&quot;&gt;The user user@domain.com could not be mapped with an existing user in passbolt because it was created after.&lt;/h3&gt;
    &lt;p&gt;This error happens when a user was created first in Passbolt and later in the directory. Passbolt then considers that the passbolt user has the priority and should not be synced, since it would also mean that the same user would get
deleted whenever it is deleted from the directory.
When this situation happens, if you absolutely want to sync these 2 users, the solution is to delete the user in passbolt and to run the synchronization again. The user will then be created again and synced.&lt;/p&gt;

    &lt;h3 id=&quot;the-group-mygroup-could-not-be-mapped-with-an-existing-group-in-passbolt-because-it-was-created-after&quot;&gt;The group MyGroup could not be mapped with an existing group in passbolt because it was created after.&lt;/h3&gt;
    &lt;p&gt;This error happens when a group was created first in Passbolt and later in the directory. Passbolt then considers that the passbolt group has the priority and should not be synced, since it would also mean that the same group would get
deleted whenever it is deleted from the directory.
When this situation happens, if you absolutely want to sync these 2 groups, the solution is to delete the group in passbolt and to run the synchronization again. The group will then be created again and synced.&lt;/p&gt;

    &lt;h3 id=&quot;the-previously-deleted-user-userdomaincom-was-not-re-added-to-passbolt&quot;&gt;The previously deleted user user@domain.com was not re-added to passbolt.&lt;/h3&gt;
    &lt;p&gt;This error happens when a passbolt user was deleted manually in passbolt but not in the directory. Passbolt then considers that the actions performed in passbolt
have a higher priority and that the user was deleted for a good reason.
When this situation happens, if you absolutely want to sync back this user, the solution is to re-create the user in passbolt and run the synchronization again.&lt;/p&gt;

    &lt;h3 id=&quot;the-user-userdomaincom-could-not-be-added-to-the-group-mygroup-because-of-an-internal-error&quot;&gt;The user user@domain.com could not be added to the group MyGroup because of an internal error&lt;/h3&gt;
    &lt;p&gt;This error usually happens when the group could not be created in Passbolt for some reason, which means that it is impossible for the
system to create a group membership for the given user.&lt;/p&gt;

    &lt;h3 id=&quot;a-request-to-add-user-userdomaincom-in-group-mygroup-was-sent-to-the-group-manager&quot;&gt;A request to add user user@domain.com in group MyGroup was sent to the group manager.&lt;/h3&gt;
    &lt;p&gt;This scenario happens when passbolt attempts to add a user to a group that has passwords directly shared with it. 
In this case, adding our user to the group would mean having to encrypt all the passwords shared with the group for this new group member. 
Due to the end-to-end nature of the solution, the system cannot do it without a human intervention. This is why passbolt sends a request to the group manager so that he can add the user to the group manually, and encrypt the shared secrets at the same time.&lt;/p&gt;

    &lt;p&gt;Note: this scenario will not happen in the case of groups without direct access to shared passwords. In this case, the user will be added automatically to the group during the sync.&lt;/p&gt;

    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
October
11th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="configure" /><category term="ldap" /><summary type="html"></summary></entry><entry><title type="html">Configure Ldap plugin</title><link href="https://help.passbolt.com/configure/ldap/setup.html" rel="alternate" type="text/html" title="Configure Ldap plugin" /><published>2021-10-11T02:00:00+02:00</published><updated>2021-10-11T02:00:00+02:00</updated><id>https://help.passbolt.com/configure/ldap/setup</id><content type="html" xml:base="https://help.passbolt.com/configure/ldap/setup.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;&lt;img src=&quot;/assets/img/help/2018/09/AD_ldap_overview.png&quot; alt=&quot;ldap illustration&quot; style=&quot;margin: auto;&quot; /&gt;&lt;/p&gt;

    &lt;div class=&quot;message warning&quot;&gt;
    &lt;p&gt;
        &lt;strong&gt;Important:&lt;/strong&gt; The LDAP connector will send an invitation email to all the users matching your configuration during a synchronization. If you are simply testing it, make sure not to perform an actual synchronization (use simulate sync instead), or disable the cron job to send emails first.
    &lt;/p&gt;
    
&lt;/div&gt;

    &lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

    &lt;h3 id=&quot;what-is-it&quot;&gt;What is it?&lt;/h3&gt;

    &lt;p&gt;The goal of the directory synchronization tool, also called LDAP connector, is to provide a way for a passbolt
administrator to synchronize a list of groups and users, as well as the associated group memberships.&lt;/p&gt;

    &lt;p&gt;Currently the connector supports two types of directory: OpenLDAP and Microsoft Active Directory. In the future
we will also support other non ldap based user directories such as Google API User Directory.&lt;/p&gt;

    &lt;h3 id=&quot;how-does-it-work&quot;&gt;How does it work?&lt;/h3&gt;

    &lt;p&gt;In a nutshell this part of the application will try to keep passbolt and a directory in sync with a minimal
involvement of the administrators and group managers. However if an action is not possible, such as, deleting
a user that is the sole password owner, the process triggers will trigger relevant email notifications so
that a human can solve it manually. An admin can also alternatively tell passbolt to ignore a record in the
next synchronization round, if the issue does not need to be resolved.&lt;/p&gt;

    &lt;h3 id=&quot;requirements&quot;&gt;Requirements&lt;/h3&gt;

    &lt;div class=&quot;message warning&quot;&gt;
    &lt;p&gt;
        &lt;strong&gt;Important:&lt;/strong&gt; If you have installed passbolt-pro using our debian and ubuntu packages you can skip this section
    &lt;/p&gt;
    
&lt;/div&gt;

    &lt;p&gt;The directory synchronization tools requires the &lt;a href=&quot;https://secure.php.net/manual/en/book.ldap.php&quot;&gt;php-ldap extension&lt;/a&gt;
to be present on the server. If you built your own server the way you install
&lt;a href=&quot;https://packages.debian.org/stretch/php-ldap&quot;&gt;php-ldap&lt;/a&gt; will depend on your system flavor.&lt;/p&gt;

    &lt;p&gt;On Debian using nginx for example you can do:&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;php-ldap
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;service nginx restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Make sure the ldap extension is present in the php-cli.ini file.
You should add &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;extension=ldap.so&lt;/code&gt; if it is not already present:&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;php &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; |grep php&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;ini
Configuration File &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;php.ini&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Path &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /etc/php/7.3/cli
Loaded Configuration File &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /etc/php/7.3/cli/php.ini
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nano /etc/php/7.3/cli/php.ini
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;For testing purpose, it might be handy to have some &lt;a href=&quot;https://wiki.debian.org/LDAP/LDAPUtils&quot;&gt;ldap utilities&lt;/a&gt;
installed on your system. On Debian you can use ldapsearch for example to search for and display entries:&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;ldap-utils
ldapsearch &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'dc=example,dc=com'&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;The plugin relies on a 3rd party library called ldaptools which you will need to install as part of your passbolt
update or install. You can get it the same way than other php dependencies using composer:&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /var/www/passbolt
git pull origin master
composer &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
./bin/cake passbolt migrate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;To run, the ldap plugin needs to have at least one active admin user existing inside passbolt.&lt;/p&gt;

    &lt;h2 id=&quot;limitations&quot;&gt;Limitations&lt;/h2&gt;

    &lt;p&gt;The Ldap plugin doesn’t support nested groups in the current version. This improvement will be added later,
once groups inside groups is supported by passbolt.&lt;/p&gt;

    &lt;p&gt;A delegated authentication (such as using a LDAP user password as replacement of the passphrase) is currently
not supported (and is not a trivial problem) but could still be considered in the future. If you are interested
in this feature you can join the discussion on the
&lt;a href=&quot;https://community.passbolt.com/t/as-a-user-i-can-login-using-my-organization-ldap-credentials/159&quot;&gt;community forum&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;The following improvements will also be shipped gradually and will be available soon:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Test mode: the capability to test the configuration and mapping directly from the configuration screen.&lt;/li&gt;
      &lt;li&gt;Report screens: the synchronization reports will be available in the admin workspace.&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;how-to-use&quot;&gt;How to use?&lt;/h2&gt;

    &lt;div class=&quot;message warning&quot;&gt;
    &lt;p&gt;
        &lt;strong&gt;Please note:&lt;/strong&gt; This guide explains how to configure the Ldap connector through the UI. For complex configurations (for example custom field mapping in openldap) you will need to &lt;a href=&quot;/configure/ldap/ldap-from-configuration-file&quot;&gt;configure ldap directly through the configuration file&lt;/a&gt;.
    &lt;/p&gt;
    
&lt;/div&gt;

    &lt;h3 id=&quot;activate-the-plugin&quot;&gt;Activate the plugin&lt;/h3&gt;

    &lt;p&gt;The plugin is deactivated by default. You need to activate it to be able to use it.
While logged in as an admin, click on the administration menu item in the top menu, and then click on “Users Directory”&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2018/12/AD_directory_sync_settings_disabled.png&quot; alt=&quot;Ldap directory settings screen (disabled)&quot; style=&quot;max-width:660px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Ldap directory settings screen (disabled)&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Click on the switch next to “Users Directory” to enable the plugin.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2018/12/AD_directory_sync_settings_enabled.png&quot; alt=&quot;Ldap directory settings screen (enabled)&quot; style=&quot;max-width:660px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Ldap directory settings screen (enabled)&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;You will need to fill the configuration parameters with your connection details before you can save the settings and
actually activate it.&lt;/p&gt;

    &lt;h3 id=&quot;configure-the-plugin&quot;&gt;Configure the plugin&lt;/h3&gt;

    &lt;p&gt;The available options are:&lt;/p&gt;

    &lt;table class=&quot;table-parameters&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
        &lt;th width=&quot;25%&quot;&gt;Parameter&lt;/th&gt;
        &lt;th width=&quot;33%&quot;&gt;Details&lt;/th&gt;
        &lt;th&gt;Example&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
        &lt;td&gt;
        Directory Type&lt;br /&gt;
        &lt;em&gt;(required)&lt;/em&gt;
        &lt;/td&gt;
        &lt;td&gt;
        Choose here the type of your directory. Currently only Active Directory and OpenLdap are supported.
        &lt;/td&gt;
        &lt;td&gt;
        &lt;code&gt;Active Directory&lt;/code&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;
        Domain&lt;br /&gt;
        &lt;em&gt;(required)&lt;/em&gt;
        &lt;/td&gt;
        &lt;td&gt;
        The domain your directory is configured with.
        &lt;/td&gt;
        &lt;td&gt;
        &lt;code&gt;mydomain.local&lt;/code&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;
        Server URL&lt;br /&gt;
        &lt;em&gt;(required)&lt;/em&gt;
        &lt;/td&gt;
        &lt;td&gt;
        The full url to reach your server.
        &lt;/td&gt;
        &lt;td&gt;
        &lt;code&gt;ldap://198.163.0.1:389&lt;/code&gt;
        &lt;/td&gt;
     &lt;/tr&gt;
     &lt;tr&gt;
         &lt;td&gt;
         Username and password&lt;br /&gt;
         &lt;em&gt;(required)&lt;/em&gt;
         &lt;/td&gt;
         &lt;td&gt;
         Username and password to authentify on your directory
         &lt;/td&gt;
         &lt;td&gt;
         &lt;/td&gt;
     &lt;/tr&gt;
     &lt;tr&gt;
          &lt;td&gt;
          Base DN&lt;br /&gt;
          &lt;em&gt;(required)&lt;/em&gt;
          &lt;/td&gt;
          &lt;td&gt;
          The base DN (default naming context) for the domain.
          &lt;/td&gt;
          &lt;td&gt;
          &lt;code&gt;OU=OrgUsers,DC=mydomain,DC=local&lt;/code&gt;
          &lt;/td&gt;
     &lt;/tr&gt;
     &lt;tr&gt;
        &lt;td&gt;
        Group path&lt;br /&gt;
        &lt;em&gt;(optional)&lt;/em&gt;
        &lt;/td&gt;
        &lt;td&gt;
        If your groups are located in a different path than your base DN, you can specify here the complementary path.
        &lt;br /&gt;&lt;br /&gt;Default value: none
        &lt;/td&gt;
        &lt;td&gt;&lt;code&gt;OU=MyGroups&lt;/code&gt;&lt;/td&gt;
     &lt;/tr&gt;
     &lt;tr&gt;
         &lt;td&gt;
         User path&lt;br /&gt;
         &lt;em&gt;(optional)&lt;/em&gt;
         &lt;/td&gt;
         &lt;td&gt;
         If your users are located in a different path than your base DN, you can specify here the complementary path.
         &lt;br /&gt;&lt;br /&gt;Default value: none
         &lt;/td&gt;
         &lt;td&gt;&lt;code&gt;OU=MyUsers&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
      &lt;td&gt;
           Group object class&lt;br /&gt;
           &lt;em&gt;(optional)&lt;/em&gt;
           &lt;/td&gt;
           &lt;td&gt;
           For OpenLdap only, you can specify here the name of the group object class that you are using in your openldap.
           &lt;br /&gt;&lt;br /&gt;Default value: groupOfUniqueNames
           &lt;/td&gt;
           &lt;td&gt;
           &lt;code&gt;groupOfUniqueNames&lt;/code&gt;
           &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
            User object class&lt;br /&gt;
            &lt;em&gt;(optional)&lt;/em&gt;
            &lt;/td&gt;
            &lt;td&gt;
            For OpenLdap only, you can specify here the name of the user object class that you are using in your openldap.
            &lt;br /&gt;&lt;br /&gt;Default value: inetOrgPerson
            &lt;/td&gt;
            &lt;td&gt;
            &lt;code&gt;inetOrgPerson&lt;/code&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
            Default admin&lt;br /&gt;
            &lt;em&gt;(required)&lt;/em&gt;
            &lt;/td&gt;
            &lt;td&gt;
            Choose here the username of the passbolt admin user that will be used to perform the operations on behalf of the synchronization tools.
            &lt;br /&gt;&lt;br /&gt;You can also create a dedicated admin user in passbolt if you want to be able to track more accurately the actions related to ldap.
            &lt;/td&gt;
            &lt;td&gt;
            &lt;code&gt;passboltadmin@domain.com&lt;/code&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
            Default group admin &lt;br /&gt;
            &lt;em&gt;(required)&lt;/em&gt;
            &lt;/td&gt;
            &lt;td&gt;
            Choose here the username of the default group manager. It is the user that will be assigned as a group manager to all new groups created by ldap.
            &lt;/td&gt;
            &lt;td&gt;
            &lt;code&gt;passboltadmin@domain.com&lt;/code&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
            Groups parent group &lt;br /&gt;
            &lt;em&gt;(optional)&lt;/em&gt;
            &lt;/td&gt;
            &lt;td&gt;
            Using this filter will list only groups that are part of the given parent group (recursively). Enter the parent group name.
            &lt;/td&gt;
            &lt;td&gt;
            &lt;code&gt;MyGroupName&lt;/code&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
            Users parent group &lt;br /&gt;
            &lt;em&gt;(optional)&lt;/em&gt;
            &lt;/td&gt;
            &lt;td&gt;
            Using this filter will list only users that are part of the given parent group (recursively). Enter the parent group name.
            &lt;/td&gt;
            &lt;td&gt;
            &lt;code&gt;MyGroupName&lt;/code&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;
            Enabled users only &lt;br /&gt;
            &lt;em&gt;(optional)&lt;/em&gt;
            &lt;/td&gt;
            &lt;td&gt;
            Only for AD. Synchronize only the users that are enabled (=not disabled).
            &lt;/td&gt;
            &lt;td&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
      &lt;tr&gt;
           &lt;td&gt;
           Sync operations&lt;br /&gt;
           &lt;em&gt;(optional)&lt;/em&gt;
           &lt;/td&gt;
           &lt;td&gt;
           By default, the synchronization will be done for all created / deleted users and groups in your directory and all edited group members. You can enable / disable some tasks here.
           &lt;br /&gt;&lt;br /&gt;Default value: everything is enabled.
           &lt;/td&gt;
           &lt;td&gt;
           &lt;/td&gt;
        &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

    &lt;h3 id=&quot;save-configuration&quot;&gt;Save configuration&lt;/h3&gt;

    &lt;p&gt;Once the configuration is entered, do not forget to save it by clicking on the “save settings” at the top. The configuration will be saved
only if passbolt managed to connect to your directory. If not, it will display an error message.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2018/12/AD_directory_sync_settings_saved.png&quot; alt=&quot;Ldap directory settings have been saved&quot; style=&quot;max-width:660px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Ldap directory settings have been saved&lt;/span&gt;
&lt;/figure&gt;

    &lt;h3 id=&quot;test-configuration-and-simulate-sync&quot;&gt;Test configuration and simulate sync&lt;/h3&gt;

    &lt;p&gt;Once the settings have been saved, the buttons “simulate synchronize” and “synchronize” at the top have become clickable.&lt;/p&gt;

    &lt;p&gt;Before we actually do a real synchronization, we will first simulate one. Click on “simulate synchronize” and wait a few seconds. Once the simulation is complete,
a report such as the one below will be displayed.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2018/12/AD_directory_sync_simulation.png&quot; alt=&quot;Ldap directory sync simulation&quot; style=&quot;max-width:660px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Ldap directory sync simulation&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;In this report, you will be able to see what will actually happen when you will synchronize your directory for real. You will also be
able to take corrective measures before an error actually happens.&lt;/p&gt;

    &lt;h3 id=&quot;first-synchronization&quot;&gt;First synchronization&lt;/h3&gt;

    &lt;p&gt;To do the first synchronization, repeat the same process as above. Only, click on “synchronize” this time. A similar report to the one that was displayed during a simulate
will appear and let you know what happened exactly.&lt;/p&gt;

    &lt;h3 id=&quot;user-synchronization-example-workflow&quot;&gt;User synchronization example workflow&lt;/h3&gt;

    &lt;p&gt;When an user is created in LDAP, they are imported in Passbolt using synchronization.&lt;/p&gt;

    &lt;p&gt;If you delete this user in Passbolt, he will remain present in LDAP but won’t be added back to Passbolt on next synchronization.&lt;/p&gt;

    &lt;p&gt;If you want to re-sync this user with LDAP, manually re-create him in Passbolt then run synchronization. Passbolt synchronization tool will automatically recreate the link in Passbolt database.&lt;/p&gt;

    &lt;p&gt;If you delete this user in LDAP, he will be deleted from Passbolt on next synchronization.&lt;/p&gt;
    &lt;h3 id=&quot;how-to-synchronize-my-directory-automatically&quot;&gt;How to synchronize my directory automatically?&lt;/h3&gt;
    &lt;p&gt;To synchronize the changes automatically you will need to add a cron job on your server. We recommend to execute the job once a day, but you can choose as per your preference.&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0 0 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; su &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/var/www/passbolt/bin/cake directory_sync all&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; /bin/bash www-data &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /var/log/cron.log 2&amp;gt;&amp;amp;1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;For debian and ubuntu systems where passbolt is installed through our supported packages:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0 0 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; su &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/php/passbolt/bin/cake directory_sync all&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; /bin/bash www-data &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /var/log/cron.log 2&amp;gt;&amp;amp;1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;configure-ldap-with-ssl-ldaps&quot;&gt;Configure ldap with SSL (ldaps)&lt;/h2&gt;
    &lt;p&gt;If your configuration doesn’t run out of the box with ldaps, you can refer to the &lt;a href=&quot;/configure/ldap-with-ssl&quot;&gt;ldap with ssl&lt;/a&gt; documentation in order to adjust your config or throubleshoot your issue.&lt;/p&gt;

    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
October
11th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues with Passbolt Pro Edition?&lt;/p&gt;
    &lt;a href=&quot;mailto:contact@passbolt.com&quot; class=&quot;button primary&quot;&gt;Contact Pro support&lt;/a&gt;
    &lt;p&gt;or &lt;a href=&quot;https://community.passbolt.com&quot;&gt;ask the community&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="configure" /><category term="ldap" /><summary type="html"></summary></entry><entry><title type="html">Docker</title><link href="https://help.passbolt.com/hosting/backup/docker.html" rel="alternate" type="text/html" title="Docker" /><published>2021-10-01T02:00:00+02:00</published><updated>2021-10-01T02:00:00+02:00</updated><id>https://help.passbolt.com/hosting/backup/docker</id><content type="html" xml:base="https://help.passbolt.com/hosting/backup/docker.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;Making regular backups is a critical aspect of managing a passbolt instance. Because passbolt stores important
information, it is equally important to have a backup strategy in place.&lt;/p&gt;

    &lt;p&gt;As a passbolt administrator it is your responsibility to define how often and when to perform backups.
Please automate and customize this process to match the needs and policies of your organization.&lt;/p&gt;

    &lt;p&gt;Here are some best practices to keep in mind:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;Ensure that the backups are taken at intervals that match your usage&lt;/li&gt;
      &lt;li&gt;Take these backups off-site, or to another environment than the live one&lt;/li&gt;
      &lt;li&gt;Make sure the backup is encrypted and stored in a safe location&lt;/li&gt;
      &lt;li&gt;Practice drills and test the backups to make sure they work&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;what-to-backup&quot;&gt;What to backup?&lt;/h2&gt;

    &lt;p&gt;If you are a PRO user, ensure you have a backup of your subscription key.&lt;/p&gt;

    &lt;p&gt;There are also several elements you need to backup:&lt;/p&gt;

    &lt;p&gt;We assume here Passbolt container is named “&lt;strong&gt;passbolt-container&lt;/strong&gt;” and MariaDB 
container “&lt;strong&gt;database-container&lt;/strong&gt;”.
Please replace these names with your own. You can use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker ps&lt;/code&gt; for this.&lt;/p&gt;

    &lt;div class=&quot;message warning&quot;&gt;
    &lt;p&gt;
        Many docker users use “&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-ti&lt;/code&gt;”, “&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-it&lt;/code&gt;” or “&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t -i&lt;/code&gt;” arguments to execute commands on docker containers. To get reliable backups on docker, please use only &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-i&lt;/code&gt;, as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t&lt;/code&gt; will create a pseudo-tty and make your backup files unusuable.
    &lt;/p&gt;
    
&lt;/div&gt;

    &lt;h4 id=&quot;the-database&quot;&gt;1. The database&lt;/h4&gt;

    &lt;p&gt;This can be easily scripted using &lt;a href=&quot;https://mariadb.com/kb/en/mariadb/mysqldump/&quot;&gt;mysqldump&lt;/a&gt;.
Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker exec&lt;/code&gt; to connect to the Passbolt database container and write mysqldump output to a local file.&lt;/p&gt;

    &lt;p&gt;Be sure to use simple-quotes for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bash -c&lt;/code&gt; argument to be able to use MYSQL_USER, MYSQL_PASSWORD and MYSQL_DATABASE environment variables.&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; database-container bash &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;s1&quot;&gt;'mysqldump -u${MYSQL_USER} -p${MYSQL_PASSWORD} ${MYSQL_DATABASE}'&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /path/to/backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;the-server-public-and-private-keys&quot;&gt;2. The server public and private keys&lt;/h4&gt;

    &lt;p&gt;You can use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker cp&lt;/code&gt; to backup the Passbolt GPG keys:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker &lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;passbolt-container:/etc/passbolt/gpg/serverkey_private.asc &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    /path/to/backup/serverkey_private.asc
docker &lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;passbolt-container:/etc/passbolt/gpg/serverkey.asc &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    /path/to/backup/serverkey.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;the-application-configuration&quot;&gt;3. The application configuration&lt;/h4&gt;

    &lt;p&gt;Passbolt docker stores its configuration as environment variables.&lt;/p&gt;

    &lt;p&gt;If you are using docker-compose, environment variables are on the env folder:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;env/passbolt.env&lt;/li&gt;
      &lt;li&gt;env/mysql.env&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;If you are running docker container, you should have passed these variables through the command line.
Please check the
&lt;a href=&quot;/configure/environment/reference.html&quot;&gt;passbolt env variable reference&lt;/a&gt;&lt;/p&gt;

    &lt;h4 id=&quot;the-avatars-for-passbolt-version-prior-to-32&quot;&gt;4. The avatars (for Passbolt version prior to 3.2)&lt;/h4&gt;

    &lt;div class=&quot;message notice&quot;&gt;
    &lt;p&gt;
    Since Passbolt 3.2, user’s avatars are no longer stored on disk but on the avatars table of passbolt database.
    &lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; passbolt-container &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;tar &lt;/span&gt;cvfzp - &lt;span class=&quot;nt&quot;&gt;-C&lt;/span&gt; /usr/share/php/passbolt/ webroot/img/avatar &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; passbolt-avatars.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;backup-list&quot;&gt;Backup list&lt;/h2&gt;

    &lt;p&gt;At the end of the backup process you should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;a dump of your database&lt;/li&gt;
      &lt;li&gt;the server public and private GPG keys&lt;/li&gt;
      &lt;li&gt;a copy of your config/passbolt.php configuration file&lt;/li&gt;
      &lt;li&gt;a copy of your avatar folder (&lt;strong&gt;only if Passbolt version &amp;lt; 3.2&lt;/strong&gt;)&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;what-about-the-secret-keys-of-my-collaborators&quot;&gt;What about the secret keys of my collaborators?&lt;/h2&gt;

    &lt;p&gt;Every user private key should also be backed up, this is however not something we/you can automate easily for now (passbolt might provide a functionality for this in the future). We believe it is best if this is the responsibility of the end user. There is a dedicated step during the extension setup to that purpose.&lt;/p&gt;

    &lt;p&gt;As an administrator you should stress the importance of backing up secret keys to other users. For example this warning could be part of the initial information message sent to introduce passbolt to new users.&lt;/p&gt;

    &lt;p&gt;It is possible that having users back up their own keys may not be realistic or desirable in your case. In this case you can opt in for an alternative strategy such as setting up the account with/for them and taking a backup of the secret keys then. In the worst case scenario you could automate the process by installing a script on your users machine that would make that backup for you.&lt;/p&gt;

    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
October
1st,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Do you have a question about backups? Do you want to share your experience and best practices?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Get in touch!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="backup" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt CE to a new Docker</title><link href="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-docker.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt CE to a new Docker" /><published>2021-09-29T02:00:00+02:00</published><updated>2021-09-29T02:00:00+02:00</updated><id>https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-docker</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-docker.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new  server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A new server with Docker&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-server&quot;&gt;Prepare the new server&lt;/h2&gt;

    &lt;p&gt;Create a fresh new Passbolt instance on Docker following &lt;a href=&quot;/hosting/install/ce/docker.html&quot;&gt;this documentation&lt;/a&gt;.&lt;/p&gt;

    &lt;h2 id=&quot;migrate-the-data&quot;&gt;Migrate the data&lt;/h2&gt;

    &lt;h3 id=&quot;stop-running-containers&quot;&gt;Stop running containers&lt;/h3&gt;

    &lt;p&gt;At this step, you should have a running empty Passbolt instance running on your server. We will now stop it and delete the database volume.&lt;/p&gt;

    &lt;p&gt;If you have chosen the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose&lt;/code&gt; install, you just have to delete the volumes you created with this command (don’t forget the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-v&lt;/code&gt;):&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker-compose down &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you have chosen to run docker containers, stop them and delete the database volume:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker stop passbolt-container-name
docker stop passbolt-database-name
docker volume rm passbolt-database-volume-name
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Of course, replace containers and volume name with your own !&lt;/p&gt;

    &lt;h3 id=&quot;restore-your-database&quot;&gt;Restore your database&lt;/h3&gt;

    &lt;p&gt;According to &lt;a href=&quot;https://hub.docker.com/_/mariadb&quot;&gt;MariaDB documentation on Docker Hub&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;When a container is started for the first time, a new database with the specified name will be created and initialized with the provided configuration variables.

Furthermore, it will execute files with extensions .sh, .sql, .sql.gz, and .sql.xz that are found in /docker-entrypoint-initdb.d. Files will be executed in alphabetical order. .sh files without file execute permission are sourced rather than executed.

You can easily populate your mariadb services by mounting a SQL dump into that directory and provide custom images with contributed data. SQL files will be imported by default to the database specified by the MARIADB_DATABASE / MYSQL_DATABASE variable.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;So you just have to mount your database backup file on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/docker-entrypoint-initdb.d&lt;/code&gt; folder of the database container.&lt;/p&gt;

    &lt;p&gt;If you are using docker-compose, add a volume mount in the db service:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;volumes:
  - database_volume:/var/lib/mysql
  - ./path/to/your/database/dump.sql:/docker-entrypoint-initdb.d/dump.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;And if you are not using compose, add a volume to your docker command, eg:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;docker run &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; mariadb &lt;span class=&quot;nt&quot;&gt;--net&lt;/span&gt; passbolt_network &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;--mount&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;mariadb_passbolt_data,target&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/var/lib/mysql &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;--mount&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;./path/to/your/database/dump.sql:/docker-entrypoint-initdb.d/dump.sql &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;MYSQL_ROOT_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;root_password&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;MYSQL_DATABASE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;mariadb_database&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;MYSQL_USER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;mariadb_user&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;MYSQL_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;mariadb_password&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             mariadb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;You can now start your database and passbolt containers, your database will be restored at the database container start.&lt;/p&gt;

    &lt;h3 id=&quot;restore-gpg-server-keys&quot;&gt;Restore GPG server keys&lt;/h3&gt;

    &lt;p&gt;Copy the GPG you backed up in your container:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker cp serverkey_private.asc your-passbolt-container:/etc/passbolt/gpg/serverkey_private.asc
docker cp serverkey.asc your-passbolt-container:/etc/passbolt/gpg/serverkey.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Then set correct rights:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker exec -it your-passbolt-container chown www-data:www-data /etc/passbolt/gpg/serverkey.asc
docker exec -it your-passbolt-container chown www-data:www-data /etc/passbolt/gpg/serverkey_private.asc
docker exec -it your-passbolt-container chmod 440 /etc/passbolt/gpg/serverkey.asc
docker exec -it your-passbolt-container chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h3 id=&quot;restore-avatars-if-you-are-coming-for-prior-32&quot;&gt;Restore avatars (if you are coming for prior 3.2)&lt;/h3&gt;

    &lt;div class=&quot;message warning&quot;&gt;
    &lt;p&gt;
        This step is needed only if you come from Passbolt version prior to 3.2. Since 3.2, avatars are stored in database
    &lt;/p&gt;
    
&lt;/div&gt;

    &lt;p&gt;Extract the avatars to the Passbolt docker container:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat passbolt-avatars.tar.gz | docker exec -i your-passbolt-container tar -C /usr/share/php/passbolt/ -xzf -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Then set correct rights to the avatars:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker exec -it your-passbolt-container chown -R www-data:www-data /usr/share/php/passbolt/webroot/img/avatar
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
September
29th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="ce" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt PRO to a new Docker</title><link href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-docker.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt PRO to a new Docker" /><published>2021-09-29T02:00:00+02:00</published><updated>2021-09-29T02:00:00+02:00</updated><id>https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-docker</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-docker.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new  server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A new server with Docker&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-server&quot;&gt;Prepare the new server&lt;/h2&gt;

    &lt;p&gt;Create a fresh new Passbolt instance on Docker following &lt;a href=&quot;/hosting/install/pro/docker.html&quot;&gt;this documentation&lt;/a&gt;.&lt;/p&gt;

    &lt;h2 id=&quot;migrate-the-data&quot;&gt;Migrate the data&lt;/h2&gt;

    &lt;h3 id=&quot;stop-running-containers&quot;&gt;Stop running containers&lt;/h3&gt;

    &lt;p&gt;At this step, you should have a running empty Passbolt instance running on your server. We will now stop it and delete the database volume.&lt;/p&gt;

    &lt;p&gt;If you have chosen the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose&lt;/code&gt; install, you just have to delete the volumes you created with this command (don’t forget the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-v&lt;/code&gt;):&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker-compose down &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you have chosen to run docker containers, stop them and delete the database volume:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker stop passbolt-container-name
docker stop passbolt-database-name
docker volume rm passbolt-database-volume-name
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Of course, replace containers and volume name with your own !&lt;/p&gt;

    &lt;h3 id=&quot;restore-your-database&quot;&gt;Restore your database&lt;/h3&gt;

    &lt;p&gt;According to &lt;a href=&quot;https://hub.docker.com/_/mariadb&quot;&gt;MariaDB documentation on Docker Hub&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;When a container is started for the first time, a new database with the specified name will be created and initialized with the provided configuration variables.

Furthermore, it will execute files with extensions .sh, .sql, .sql.gz, and .sql.xz that are found in /docker-entrypoint-initdb.d. Files will be executed in alphabetical order. .sh files without file execute permission are sourced rather than executed.

You can easily populate your mariadb services by mounting a SQL dump into that directory and provide custom images with contributed data. SQL files will be imported by default to the database specified by the MARIADB_DATABASE / MYSQL_DATABASE variable.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;So you just have to mount your database backup file on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/docker-entrypoint-initdb.d&lt;/code&gt; folder of the database container.&lt;/p&gt;

    &lt;p&gt;If you are using docker-compose, add a volume mount in the db service:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;volumes:
  - database_volume:/var/lib/mysql
  - ./path/to/your/database/dump.sql:/docker-entrypoint-initdb.d/dump.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;And if you are not using compose, add a volume to your docker command, eg:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;docker run &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; mariadb &lt;span class=&quot;nt&quot;&gt;--net&lt;/span&gt; passbolt_network &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;--mount&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;mariadb_passbolt_data,target&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/var/lib/mysql &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;--mount&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;./path/to/your/database/dump.sql:/docker-entrypoint-initdb.d/dump.sql &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;MYSQL_ROOT_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;root_password&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;MYSQL_DATABASE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;mariadb_database&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;MYSQL_USER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;mariadb_user&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;MYSQL_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;mariadb_password&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
             mariadb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;You can now start your database and passbolt containers, your database will be restored at the database container start.&lt;/p&gt;

    &lt;h3 id=&quot;restore-gpg-server-keys&quot;&gt;Restore GPG server keys&lt;/h3&gt;

    &lt;p&gt;Copy the GPG you backed up in your container:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker cp serverkey_private.asc your-passbolt-container:/etc/passbolt/gpg/serverkey_private.asc
docker cp serverkey.asc your-passbolt-container:/etc/passbolt/gpg/serverkey.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Then set correct rights:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker exec -it your-passbolt-container chown www-data:www-data /etc/passbolt/gpg/serverkey.asc
docker exec -it your-passbolt-container chown www-data:www-data /etc/passbolt/gpg/serverkey_private.asc
docker exec -it your-passbolt-container chmod 440 /etc/passbolt/gpg/serverkey.asc
docker exec -it your-passbolt-container chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h3 id=&quot;restore-avatars-if-you-are-coming-for-prior-32&quot;&gt;Restore avatars (if you are coming for prior 3.2)&lt;/h3&gt;

    &lt;div class=&quot;message warning&quot;&gt;
    &lt;p&gt;
        This step is needed only if you come from Passbolt version prior to 3.2. Since 3.2, avatars are stored in database
    &lt;/p&gt;
    
&lt;/div&gt;

    &lt;p&gt;Extract the avatars to the Passbolt docker container:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat passbolt-avatars.tar.gz | docker exec -i your-passbolt-container tar -C /usr/share/php/passbolt/ -xzf -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Then set correct rights to the avatars:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker exec -it your-passbolt-container chown -R www-data:www-data /usr/share/php/passbolt/webroot/img/avatar
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
September
29th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="pro" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt PRO to Virtual Machine</title><link href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-virtual-machine.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt PRO to Virtual Machine" /><published>2021-09-16T02:00:00+02:00</published><updated>2021-09-16T02:00:00+02:00</updated><id>https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-virtual-machine</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-virtual-machine.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new Virtual Machine Appliance.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-virtual-machine-appliance-for-migration&quot;&gt;Prepare the Virtual Machine Appliance for migration&lt;/h2&gt;

    &lt;div class=&quot;message warning&quot;&gt;
    &lt;p&gt;
        While configuring the database ensure you are configuring the database as it was on your previous server, check the backup of the file passbolt.php for the configuration details.
    &lt;/p&gt;
    
&lt;/div&gt;

    &lt;p&gt;Passbolt Pro provides a virtual appliance in OVA format. Users can import this appliance on their private virtualization platform and start enjoying Passbolt Pro.
The VM includes the following software:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Debian 10&lt;/li&gt;
      &lt;li&gt;Nginx&lt;/li&gt;
      &lt;li&gt;Php-fpm&lt;/li&gt;
      &lt;li&gt;Mariadb&lt;/li&gt;
      &lt;li&gt;Passbolt Pro preinstalled&lt;/li&gt;
      &lt;li&gt;certbot&lt;/li&gt;
      &lt;li&gt;haveged to fill the entropy pool faster&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;getting-started-with-passbolt-pro-vm&quot;&gt;1. Getting started with Passbolt Pro VM&lt;/h2&gt;

    &lt;h3 id=&quot;download&quot;&gt;1.1 Download&lt;/h3&gt;

    &lt;p&gt;Download the ova and the SHA512SUM.txt:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;https://www.passbolt.com/pro/download/vm/debian/latest&quot;&gt;Passbolt Pro VM&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://www.passbolt.com/pro/download/vm/debian/latest-checksum&quot;&gt;SHA512SUM.txt&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;Import the ova file using virtualbox, vmware (ESXi &amp;gt;= 6.0) or any other platform that supports import OVA files.&lt;/p&gt;

    &lt;p&gt;Once imported into users should be able to boot the VM and just point to the VM ip address with their web browser to initiate the passbolt install process.&lt;/p&gt;

    &lt;h3 id=&quot;credentials&quot;&gt;1.2 Credentials&lt;/h3&gt;

    &lt;p&gt;The appliance performs some actions on the first boot:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Creates ssh host keys&lt;/li&gt;
      &lt;li&gt;Enables ssh&lt;/li&gt;
      &lt;li&gt;Creates a set of random mariadb credentials for the mariadb server installed on the appliance&lt;/li&gt;
      &lt;li&gt;Creates an empty database where passbolt can be installed.&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;For the first login the appliance comes with the following ssh default credentials:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;VM login credentials:
username: passbolt
password: admin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt&lt;/code&gt; user is part of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; group. There is no root password, so you cannot
login in as root. You can however create a shell as root with the default user:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;configure-the-ova-services&quot;&gt;Configure the OVA Services&lt;/h2&gt;

    &lt;p&gt;Reconfigure the Passbolt package:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dpkg-reconfigure passbolt-pro-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;configure-mariadb&quot;&gt;Configure mariadb&lt;/h4&gt;

    &lt;p&gt;If not instructed otherwise passbolt debian package will install mariadb-server locally. This step will help you create
an empty mariadb database for passbolt to use.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/configure_mysql_pro.png&quot; alt=&quot;Configure mariadb dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Configure mariadb dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;The configuration process will ask you for the credentials of the mariadb admin user to create a new database.
You will find the root password on the server in the file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/root/.mysql_credentials&lt;/code&gt;.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user_pro.png&quot; alt=&quot;Mariadb admin user dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb admin user dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user_pass_pro.png&quot; alt=&quot;Mariadb admin user pass dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb admin user pass dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Now we need to create a mariadb user with reduced permissions for passbolt to connect. For the passbolt database user and password, reuse the ones you have in your backup of passbolt.php.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_name_pro.png&quot; alt=&quot;Mariadb passbolt user dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb passbolt user dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_pass_pro.png&quot; alt=&quot;Mariadb passbolt user pass dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb passbolt user pass dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Lastly we need to create a database for passbolt to use, for that we need to name it:&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/db_name_pro.png&quot; alt=&quot;Mariadb database name dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb database name dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Depending on your needs there are two different options to setup nginx and SSL using the debian package:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;/configure/https/pro/debian/auto.html&quot;&gt;Auto (Using Let’s Encrypt)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;/configure/https/pro/debian/manual.html&quot;&gt;Manual (Using user-provided SSL certificates)&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;Once you’re done, restart the nginx server:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo systemctl restart nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;migrate-the-data&quot;&gt;Migrate the data&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new Debian server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;Your subscription key&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Create the subscription key file&lt;/p&gt;

    &lt;p&gt;You received your subscription key by email, copy it as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passbolt/subscription_key.txt&lt;/code&gt; on your server.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown www-data:www-data /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown www-data: /etc/passbolt/gpg/serverkey_private.asc
sudo chown www-data: /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R www-data:www-data /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Migrate the Passbolt data to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u www-data /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 7.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u www-data /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
September
16th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="pro" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt PRO to a new Debian server</title><link href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-debian-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt PRO to a new Debian server" /><published>2021-09-16T02:00:00+02:00</published><updated>2021-09-16T02:00:00+02:00</updated><id>https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-debian-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-debian-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new Debian server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal Debian 10 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-debian-server&quot;&gt;Prepare the new Debian server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt PRO and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Update the apt indexes and install packages to allow apt to use https repositories:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get update
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Optionally you can install certbot to enable &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt; configuration:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt;  Add Passbolt package official GnuPG key
From keys.mailvelope.com:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key adv --keyserver hkps://keys.mailvelope.com --recv-keys 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Or from pgp.mit.edu:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key adv --keyserver hkps://pgp.mit.edu --recv-keys 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Or from keys.gnupg.net:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key adv --keyserver hkps://keys.gnupg.net --recv-keys 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt;  Check that the GPG fingerprint matches &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3D1A 0346 C8E1 802F 774A  EF21 DE8B 853F C155 581D&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key fingerprint 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pub   rsa2048 2020-05-18 [SC] [expires: 2022-05-18]
      3D1A 0346 C8E1 802F 774A  EF21 DE8B 853F C155 581D
uid           [ unknown] Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;
sub   rsa2048 2020-05-18 [E] [expires: 2022-05-18]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt;  Add passbolt repository to your apt lists:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;echo  &quot;deb https://download.passbolt.com/pro/debian buster stable&quot; | \
sudo tee /etc/apt/sources.list.d/passbolt.list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Update the apt indexes with the new passbolt apt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h3 id=&quot;install-passbolt&quot;&gt;1.2. Install passbolt&lt;/h3&gt;

    &lt;p&gt;By default, passbolt Debian package will install Passbolt server component, mariadb-server, php-fpm and nginx
as dependencies.&lt;/p&gt;

    &lt;p&gt;There are two main ways to install the passbolt Debian package:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;Interactive&lt;/strong&gt;: the package will guide the user through a set of questions to setup mariadb and nginx. If you are
going to use existing SSL certs for the web server, they need to be created and installed to the location of your choosing before
beginning. The user will be asked for the path and name of the certificate and key.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Non-interactive&lt;/strong&gt;: no questions will be asked. Useful for users with specific needs or users that want to automate the
installation. &lt;a href=&quot;/faq/hosting/how-to-install-passbolt-non-interactive&quot;&gt;Read this FAQ page to know more&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install passbolt-pro-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;configure-mariadb&quot;&gt;Configure mariadb&lt;/h4&gt;

    &lt;p&gt;If not instructed otherwise passbolt debian package will install mariadb-server locally. This step will help you create
an empty mariadb database for passbolt to use.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/configure_mysql_pro.png&quot; alt=&quot;Configure mariadb dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Configure mariadb dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;The configuration process will ask you for the credentials of the mariadb admin user to create a new database.
You will find the root password on the server in the file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/root/.mysql_credentials&lt;/code&gt;.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user_pro.png&quot; alt=&quot;Mariadb admin user dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb admin user dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user_pass_pro.png&quot; alt=&quot;Mariadb admin user pass dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb admin user pass dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Now we need to create a mariadb user with reduced permissions for passbolt to connect. For the passbolt database user and password, reuse the ones you have in your backup of passbolt.php.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_name_pro.png&quot; alt=&quot;Mariadb passbolt user dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb passbolt user dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_pass_pro.png&quot; alt=&quot;Mariadb passbolt user pass dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb passbolt user pass dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Lastly we need to create a database for passbolt to use, for that we need to name it:&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/db_name_pro.png&quot; alt=&quot;Mariadb database name dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb database name dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;h2 id=&quot;configure-nginx-for-serving-https&quot;&gt;Configure nginx for serving HTTPS&lt;/h2&gt;

    &lt;p&gt;Depending on your needs there are two different options to setup nginx and SSL using the Debian package:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;/configure/https/pro/debian/auto.html&quot;&gt;Auto (Using Let’s Encrypt)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;/configure/https/pro/debian/manual.html&quot;&gt;Manual (Using user-provided SSL certificates)&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;migrate-the-data&quot;&gt;Migrate the data&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new Debian server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;Your subscription key&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Create the subscription key file&lt;/p&gt;

    &lt;p&gt;You received your subscription key by email, copy it as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passbolt/subscription_key.txt&lt;/code&gt; on your server.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown www-data:www-data /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown www-data: /etc/passbolt/gpg/serverkey_private.asc
sudo chown www-data: /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R www-data:www-data /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Migrate the Passbolt data to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u www-data /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 7.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u www-data /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
September
16th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="pro" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt CE to a new Ubuntu server</title><link href="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-ubuntu-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt CE to a new Ubuntu server" /><published>2021-09-16T02:00:00+02:00</published><updated>2021-09-16T02:00:00+02:00</updated><id>https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-ubuntu-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-ubuntu-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new Ubuntu server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal Ubuntu 20.04 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-ubuntu-server&quot;&gt;Prepare the new Ubuntu server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt CE and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Update the apt indexes and install packages to allow apt to use https repositories:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get update
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Optionally you can install certbot to enable &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt; configuration:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt;  Add Passbolt package official GnuPG key
From keys.mailvelope.com:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key adv --keyserver hkps://keys.mailvelope.com --recv-keys 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Or from pgp.mit.edu:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key adv --keyserver hkps://pgp.mit.edu --recv-keys 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Or from keys.gnupg.net:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key adv --keyserver hkps://keys.gnupg.net --recv-keys 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt;  Check that the GPG fingerprint matches &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3D1A 0346 C8E1 802F 774A  EF21 DE8B 853F C155 581D&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key fingerprint 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pub   rsa2048 2020-05-18 [SC] [expires: 2022-05-18]
      3D1A 0346 C8E1 802F 774A  EF21 DE8B 853F C155 581D
uid           [ unknown] Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;
sub   rsa2048 2020-05-18 [E] [expires: 2022-05-18]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt;  Add passbolt repository to your apt lists:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;echo  &quot;deb https://download.passbolt.com/ce/ubuntu focal stable&quot; | \
sudo tee /etc/apt/sources.list.d/passbolt.list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Update the apt indexes with the new passbolt apt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h3 id=&quot;install-passbolt&quot;&gt;1.2. Install passbolt&lt;/h3&gt;

    &lt;p&gt;By default, passbolt Ubuntu package will install Passbolt server component, mariadb-server, php-fpm and nginx
as dependencies.&lt;/p&gt;

    &lt;p&gt;There are two main ways to install the passbolt Ubuntu package:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;Interactive&lt;/strong&gt;: the package will guide the user through a set of questions to setup mariadb and nginx. If you are
going to use existing SSL certs for the web server, they need to be created and installed to the location of your choosing before
beginning. The user will be asked for the path and name of the certificate and key.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Non-interactive&lt;/strong&gt;: no questions will be asked. Useful for users with specific needs or users that want to automate the
installation. &lt;a href=&quot;/faq/hosting/how-to-install-passbolt-non-interactive&quot;&gt;Read this FAQ page to know more&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install passbolt-ce-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;configure-mariadb&quot;&gt;Configure mariadb&lt;/h4&gt;

    &lt;p&gt;If not instructed otherwise passbolt ubuntu package will install mariadb-server locally. This step will help you create
an empty mariadb database for passbolt to use.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/configure_mysql.png&quot; alt=&quot;Configure mariadb dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Configure mariadb dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;The configuration process will ask you for the credentials of the mariadb admin user to create a new database.
You will find the root password on the server in the file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/root/.mysql_credentials&lt;/code&gt;.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user.png&quot; alt=&quot;Mariadb admin user dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb admin user dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user_pass.png&quot; alt=&quot;Mariadb admin user pass dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb admin user pass dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Now we need to create a mariadb user with reduced permissions for passbolt to connect. For the passbolt database user and password, reuse the ones you have in your backup of passbolt.php.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_name.png&quot; alt=&quot;Mariadb passbolt user dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb passbolt user dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_pass.png&quot; alt=&quot;Mariadb passbolt user pass dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb passbolt user pass dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Lastly we need to create a database for passbolt to use, for that we need to name it:&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/db_name.png&quot; alt=&quot;Mariadb database name dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb database name dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;h2 id=&quot;configure-nginx-for-serving-https&quot;&gt;Configure nginx for serving HTTPS&lt;/h2&gt;

    &lt;p&gt;Depending on your needs there are two different options to setup nginx and SSL using the Ubuntu package:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;/configure/https/ce/debian/auto.html&quot;&gt;Auto (Using Let’s Encrypt)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;/configure/https/ce/debian/manual.html&quot;&gt;Manual (Using user-provided SSL certificates)&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;migrate-the-data&quot;&gt;Migrate the data&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new Ubuntu server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown www-data:www-data /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown www-data: /etc/passbolt/gpg/serverkey_private.asc
sudo chown www-data: /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R www-data:www-data /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Migrate the Passbolt data to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u www-data /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u www-data /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
September
16th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="ce" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt CE to a new Debian server</title><link href="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-debian-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt CE to a new Debian server" /><published>2021-09-16T02:00:00+02:00</published><updated>2021-09-16T02:00:00+02:00</updated><id>https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-debian-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-debian-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new Debian server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal Debian 10 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-debian-server&quot;&gt;Prepare the new Debian server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt CE and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Update the apt indexes and install packages to allow apt to use https repositories:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get update
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Optionally you can install certbot to enable &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt; configuration:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt;  Add Passbolt package official GnuPG key
From keys.mailvelope.com:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key adv --keyserver hkps://keys.mailvelope.com --recv-keys 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Or from pgp.mit.edu:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key adv --keyserver hkps://pgp.mit.edu --recv-keys 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Or from keys.gnupg.net:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key adv --keyserver hkps://keys.gnupg.net --recv-keys 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt;  Check that the GPG fingerprint matches &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3D1A 0346 C8E1 802F 774A  EF21 DE8B 853F C155 581D&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-key fingerprint 0xDE8B853FC155581D
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pub   rsa2048 2020-05-18 [SC] [expires: 2022-05-18]
      3D1A 0346 C8E1 802F 774A  EF21 DE8B 853F C155 581D
uid           [ unknown] Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;
sub   rsa2048 2020-05-18 [E] [expires: 2022-05-18]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt;  Add passbolt repository to your apt lists:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;echo  &quot;deb https://download.passbolt.com/ce/debian buster stable&quot; | \
sudo tee /etc/apt/sources.list.d/passbolt.list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Update the apt indexes with the new passbolt apt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h3 id=&quot;install-passbolt&quot;&gt;1.2. Install passbolt&lt;/h3&gt;

    &lt;p&gt;By default, passbolt Debian package will install Passbolt server component, mariadb-server, php-fpm and nginx
as dependencies.&lt;/p&gt;

    &lt;p&gt;There are two main ways to install the passbolt Debian package:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;Interactive&lt;/strong&gt;: the package will guide the user through a set of questions to setup mariadb and nginx. If you are
going to use existing SSL certs for the web server, they need to be created and installed to the location of your choosing before
beginning. The user will be asked for the path and name of the certificate and key.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Non-interactive&lt;/strong&gt;: no questions will be asked. Useful for users with specific needs or users that want to automate the
installation. &lt;a href=&quot;/faq/hosting/how-to-install-passbolt-non-interactive&quot;&gt;Read this FAQ page to know more&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install passbolt-ce-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;configure-mariadb&quot;&gt;Configure mariadb&lt;/h4&gt;

    &lt;p&gt;If not instructed otherwise passbolt debian package will install mariadb-server locally. This step will help you create
an empty mariadb database for passbolt to use.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/configure_mysql.png&quot; alt=&quot;Configure mariadb dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Configure mariadb dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;The configuration process will ask you for the credentials of the mariadb admin user to create a new database.
You will find the root password on the server in the file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/root/.mysql_credentials&lt;/code&gt;.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user.png&quot; alt=&quot;Mariadb admin user dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb admin user dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user_pass.png&quot; alt=&quot;Mariadb admin user pass dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb admin user pass dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Now we need to create a mariadb user with reduced permissions for passbolt to connect. For the passbolt database user and password, reuse the ones you have in your backup of passbolt.php.&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_name.png&quot; alt=&quot;Mariadb passbolt user dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb passbolt user dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_pass.png&quot; alt=&quot;Mariadb passbolt user pass dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb passbolt user pass dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;Lastly we need to create a database for passbolt to use, for that we need to name it:&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/help/2020/05/debian-package/db_name.png&quot; alt=&quot;Mariadb database name dialog&quot; style=&quot;max-width:450px;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Mariadb database name dialog&lt;/span&gt;
&lt;/figure&gt;

    &lt;h2 id=&quot;configure-nginx-for-serving-https&quot;&gt;Configure nginx for serving HTTPS&lt;/h2&gt;

    &lt;p&gt;Depending on your needs there are two different options to setup nginx and SSL using the Debian package:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;/configure/https/ce/debian/auto.html&quot;&gt;Auto (Using Let’s Encrypt)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;/configure/https/ce/debian/manual.html&quot;&gt;Manual (Using user-provided SSL certificates)&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;migrate-the-data&quot;&gt;Migrate the data&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new Debian server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown www-data:www-data /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown www-data: /etc/passbolt/gpg/serverkey_private.asc
sudo chown www-data: /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R www-data:www-data /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Migrate the Passbolt data to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u www-data /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u www-data /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
September
16th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="ce" /><summary type="html"></summary></entry><entry><title type="html">Ubuntu package</title><link href="https://help.passbolt.com/hosting/backup/ubuntu.html" rel="alternate" type="text/html" title="Ubuntu package" /><published>2021-09-16T02:00:00+02:00</published><updated>2021-09-16T02:00:00+02:00</updated><id>https://help.passbolt.com/hosting/backup/ubuntu</id><content type="html" xml:base="https://help.passbolt.com/hosting/backup/ubuntu.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;Making regular backups is a critical aspect of managing a passbolt instance. Because passbolt stores important
information, it is equally important to have a backup strategy in place.&lt;/p&gt;

    &lt;p&gt;As a passbolt administrator it is your responsibility to define how often and when to perform backups.
Please automate and customize this process to match the needs and policies of your organization.&lt;/p&gt;

    &lt;p&gt;Here are some best practices to keep in mind:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;Ensure that the backups are taken at intervals that match your usage&lt;/li&gt;
      &lt;li&gt;Take these backups off-site, or to another environment than the live one&lt;/li&gt;
      &lt;li&gt;Make sure the backup is encrypted and stored in a safe location&lt;/li&gt;
      &lt;li&gt;Practice drills and test the backups to make sure they work&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;what-to-backup&quot;&gt;What to backup?&lt;/h2&gt;

    &lt;p&gt;If you are a PRO user, ensure you have a backup of your subscription key.&lt;/p&gt;

    &lt;p&gt;There are also several elements you need to backup:&lt;/p&gt;

    &lt;h4 id=&quot;the-database&quot;&gt;1. The database&lt;/h4&gt;

    &lt;p&gt;This can be easily scripted using &lt;a href=&quot;https://mariadb.com/kb/en/mariadb/mysqldump/&quot;&gt;mysqldump&lt;/a&gt; for example:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysqldump &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;user] &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;pass] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;db] &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /path/to/backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;the-server-public-and-private-keys&quot;&gt;2. The server public and private keys&lt;/h4&gt;

    &lt;p&gt;The GPG server keys are stored under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passbolt/gpg/&lt;/code&gt; folder:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;private key is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;serverkey_private.asc&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;public key is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;serverkey.asc&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h4 id=&quot;the-application-configuration&quot;&gt;3. The application configuration&lt;/h4&gt;

    &lt;p&gt;Passbolt ubuntu package stores all configuration files under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passbolt/*&lt;/code&gt; but the one you need is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passbolt/passbolt.php&lt;/code&gt;&lt;/p&gt;

    &lt;h4 id=&quot;the-avatars-for-passbolt-version-prior-to-32&quot;&gt;4. The avatars (for Passbolt version prior to 3.2)&lt;/h4&gt;

    &lt;div class=&quot;message notice&quot;&gt;
    &lt;p&gt;
    Since Passbolt 3.2, user’s avatars are no longer stored on disk but on the avatars table of passbolt database.
    &lt;/p&gt;
    
&lt;/div&gt;

    &lt;p&gt;Back up &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/share/php/passbolt/webroot/img/avatar&lt;/code&gt; to avoid losing
the profile images.&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo tar &lt;/span&gt;cvfzp passbolt-avatars.tar.gz &lt;span class=&quot;nt&quot;&gt;-C&lt;/span&gt; /usr/share/php/passbolt/ webroot/img/avatar
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;backup-list&quot;&gt;Backup list&lt;/h2&gt;

    &lt;p&gt;At the end of the backup process you should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;a dump of your database&lt;/li&gt;
      &lt;li&gt;the server public and private GPG keys&lt;/li&gt;
      &lt;li&gt;a copy of your config/passbolt.php configuration file&lt;/li&gt;
      &lt;li&gt;a copy of your avatar folder (&lt;strong&gt;only if Passbolt version &amp;lt; 3.2&lt;/strong&gt;)&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;what-about-the-secret-keys-of-my-collaborators&quot;&gt;What about the secret keys of my collaborators?&lt;/h2&gt;

    &lt;p&gt;Every user private key should also be backed up, this is however not something we/you can automate easily for now (passbolt might provide a functionality for this in the future). We believe it is best if this is the responsibility of the end user. There is a dedicated step during the extension setup to that purpose.&lt;/p&gt;

    &lt;p&gt;As an administrator you should stress the importance of backing up secret keys to other users. For example this warning could be part of the initial information message sent to introduce passbolt to new users.&lt;/p&gt;

    &lt;p&gt;It is possible that having users back up their own keys may not be realistic or desirable in your case. In this case you can opt in for an alternative strategy such as setting up the account with/for them and taking a backup of the secret keys then. In the worst case scenario you could automate the process by installing a script on your users machine that would make that backup for you.&lt;/p&gt;

    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
September
16th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Do you have a question about backups? Do you want to share your experience and best practices?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Get in touch!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="backup" /><summary type="html"></summary></entry></feed>