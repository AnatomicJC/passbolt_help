<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="https://help.passbolt.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://help.passbolt.com/" rel="alternate" type="text/html" /><updated>2021-12-28T15:46:34+01:00</updated><id>https://help.passbolt.com/feed.xml</id><title type="html">Passbolt | Help</title><subtitle>The help site for passbolt, the open source password manager for teams. This site contains frequently asked questions, article to troubleshoot common issues, installation tutorials, blueprints for developers, and more!</subtitle><entry><title type="html">Migrate passbolt CE from install scripts to CentOS 7 package</title><link href="https://help.passbolt.com/hosting/upgrade/ce/migrate-to-centos.html" rel="alternate" type="text/html" title="Migrate passbolt CE from install scripts to CentOS 7 package" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/upgrade/ce/migrate-to-centos</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/ce/migrate-to-centos.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;A CentOS package has been created to increase the ease of installing and upgrading passbolt.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;A minimal CentOS 7 server.&lt;/li&gt;
      &lt;li&gt;Passbolt installed with the CentOS install script.&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;take-down-your-site&quot;&gt;1. Take down your site&lt;/h2&gt;

    &lt;p&gt;It is generally a good idea to stop running the site prior to the upgrade. This is to avoid having side effects
such as active users corrupting the data in the middle of an upgrade.&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl stop nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;backup-your-instance&quot;&gt;2. Backup your instance&lt;/h2&gt;

    &lt;p&gt;First things first, as this is a sensitive operation a backup of the instance must be performed to prevent any data loss.
You can follow our &lt;a href=&quot;/hosting/backup&quot;&gt;backup process&lt;/a&gt;.&lt;/p&gt;

    &lt;h2 id=&quot;upgrade-your-system&quot;&gt;3. Upgrade your system&lt;/h2&gt;

    &lt;p&gt;Passbolt requires PHP 7.3 and supports PHP 7.4.&lt;/p&gt;

    &lt;p&gt;A full system upgrade to CentOS 7 is necessary before installing the passbolt CentOS package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo yum upgrade
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;install-the-package&quot;&gt;4. Install the package&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt CE and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Configure Extra Packages for Enterprise Linux (EPEL) repository&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo yum install epel-release
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on &lt;a href=&quot;https://getfedora.org/security/&quot;&gt;this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Configure Remi’s RPM repository&lt;/p&gt;

    &lt;p&gt;As CentOS 7 don’t provide the mandatory &lt;strong&gt;php-pecl-gnupg&lt;/strong&gt; package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.&lt;/p&gt;

    &lt;p&gt;Install Remi repository configuration package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo yum install https://rpms.remirepo.net/enterprise/remi-release-7.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches &lt;a href=&quot;https://blog.remirepo.net/pages/Config-en&quot;&gt;with the one on the bottom of this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Install the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;yum-utils&lt;/code&gt; package:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo yum install yum-utils
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Enable the module stream for PHP 7.4:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo yum-config-manager --disable &apos;remi-php*&apos;
sudo yum-config-manager --enable   remi-php74
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Let’s Encrypt&lt;/p&gt;

    &lt;p&gt;Install certbot if you plan to manage your SSL certificates with &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo yum install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Setup MariaDB 10.3 repository&lt;/p&gt;

    &lt;p&gt;CentOS 7 comes with an outated MariaDB 5.x version and performance issues has been reported by using it. That’s why you should consider to upgrade MariaDB to version 10.3.&lt;/p&gt;

    &lt;p&gt;Add MariaDB 10.3 repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/mariadb.repo
[mariadb]
name = MariaDB
baseurl = http://yum.mariadb.org/10.3/centos7-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Upgrade MariaDB server from 5.5.xx to 10.3 version:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo yum install MariaDB-server MariaDB-client
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;At this step, MariaDB 5.5 has been replaced with MariaDB 10.3. You can now restart the MariaDB service:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo systemctl restart mariadb.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Run this command to upgrade MariaDB internal database schemas:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo su -s /bin/bash -c &quot;mysql_upgrade -p&quot; mysql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;You will be prompted with root mysql password and an output like the one below will be displayed:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Phase 1/7: Checking and upgrading mysql database
Processing databases
mysql
mysql.columns_priv OK
mysql.db OK
mysql.event OK
(etc etc...)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;At this step, MariaDB has been upgraded.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt;  Add passbolt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/ce/rpm/el7/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo yum install passbolt-ce-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Importing GPG key 0xC155581D:
 Userid     : &quot;Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;&quot;
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;copy-existing-configuration-to-the-new-location&quot;&gt;5. Copy existing configuration to the new location&lt;/h2&gt;

    &lt;h3 id=&quot;copy-the-server-keys&quot;&gt;5.1. Copy the server keys&lt;/h3&gt;

    &lt;p&gt;Copy the GPG server keys as following:&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /var/www/passbolt/config/gpg/serverkey.asc /etc/passbolt/gpg/
&lt;span class=&quot;nb&quot;&gt;sudo cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; /var/www/passbolt/config/gpg/serverkey_private.asc /etc/passbolt/gpg/
&lt;span class=&quot;nb&quot;&gt;sudo chown&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-R&lt;/span&gt; root:nginx /etc/passbolt/gpg
&lt;span class=&quot;nb&quot;&gt;sudo chmod &lt;/span&gt;g-w /etc/passbolt/gpg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h3 id=&quot;copy-the-passbolt-configuration&quot;&gt;5.2. Copy the passbolt configuration&lt;/h3&gt;

    &lt;p&gt;Copy passbolt configuration as following:&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo cp&lt;/span&gt; /var/www/passbolt/config/passbolt.php /etc/passbolt/passbolt.php
&lt;span class=&quot;nb&quot;&gt;sudo chown &lt;/span&gt;root:nginx /etc/passbolt/passbolt.php
&lt;span class=&quot;nb&quot;&gt;sudo chmod &lt;/span&gt;g-w /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you are running mysql 8, please change the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;quoteIdentifiers&lt;/code&gt; setting of the passbolt.php as follow:&lt;/p&gt;

    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s1&quot;&gt;&apos;quoteIdentifiers&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;nginx&quot;&gt;6. Nginx&lt;/h2&gt;

    &lt;p&gt;Now you can remove all the old nginx configuration files from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/nginx/conf.d/&lt;/code&gt;&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo rm&lt;/span&gt; /etc/nginx/conf.d/passbolt.conf
&lt;span class=&quot;nb&quot;&gt;sudo rm&lt;/span&gt; /etc/nginx/conf.d/passbolt_ssl.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;Then you can reconfigure the CentOS package using:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo /usr/local/bin/passbolt-configure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Answer the following way:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;No&lt;/strong&gt; to mariadb configuration&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Yes&lt;/strong&gt; to nginx configuration&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;You can then select the SSL method that suits best your needs.&lt;/p&gt;

    &lt;h2 id=&quot;run-the-database-migrations&quot;&gt;7. Run the database migrations&lt;/h2&gt;

    &lt;p&gt;Now it is time to run the migrations to upgrade the database schemas:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; nginx bash &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;cleanup&quot;&gt;8. Cleanup&lt;/h2&gt;

    &lt;p&gt;After you have checked you can access your new setup with the CentOS package make a backup of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/passbolt&lt;/code&gt; and then
you can delete it:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-rf&lt;/span&gt; /var/www/passbolt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;You may also want to check for the old CRON job that may need to be removed:&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;crontab &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; nginx &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;take-your-site-back-up&quot;&gt;9. Take your site back up&lt;/h2&gt;

    &lt;p&gt;Finally take passbolt back up:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl start nginx
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl restart php-fpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="ce" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt PRO to a new RockyLinux server</title><link href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-rockylinux-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt PRO to a new RockyLinux server" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-rockylinux-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-rockylinux-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new RockyLinux server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal RockyLinux 8 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-rockylinux-server&quot;&gt;Prepare the new RockyLinux server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt PRO and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Configure Extra Packages for Enterprise Linux (EPEL) repository&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install epel-release
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on &lt;a href=&quot;https://getfedora.org/security/&quot;&gt;this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Configure Remi’s RPM repository&lt;/p&gt;

    &lt;p&gt;As RockyLinux 8 don’t provide the mandatory &lt;strong&gt;php-pecl-gnupg&lt;/strong&gt; package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.&lt;/p&gt;

    &lt;p&gt;Install Remi repository configuration package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-8.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches &lt;a href=&quot;https://blog.remirepo.net/pages/Config-en&quot;&gt;with the one on the bottom of this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Enable the module stream for PHP 7.4:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf module reset php
sudo dnf module install php:remi-7.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Let’s Encrypt&lt;/p&gt;

    &lt;p&gt;Install certbot if you plan to manage your SSL certificates with &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Add passbolt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/pro/rpm/el8/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install passbolt-pro-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Importing GPG key 0xC155581D:
 Userid     : &quot;Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;&quot;
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb--nginx--ssl-settings&quot;&gt;MariaDB / Nginx / SSL settings&lt;/h4&gt;

    &lt;p&gt;Passbolt PRO RPM package on RockyLinux 8 come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.&lt;/p&gt;

    &lt;p&gt;You must prepare beforehand your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.&lt;/p&gt;

    &lt;p&gt;Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.&lt;/p&gt;

    &lt;p&gt;Launch &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-configure&lt;/code&gt; tool and answer to the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo /usr/local/bin/passbolt-configure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb&quot;&gt;MariaDB&lt;/h4&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================
Do you want to configure a local mariadb server on this machine?
================================================================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Answer &lt;strong&gt;1&lt;/strong&gt; for yes if you want to configure a local MariaDB database, otherwise &lt;strong&gt;2&lt;/strong&gt; for no if you plan to use an existing one.&lt;/p&gt;

    &lt;p&gt;If you chose yes, answer the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=======================================================
Please enter a new password for the root database user:
=======================================================
MariaDB Root Password: ****
MariaDB Root Password (verify): ****
======================================================
Please enter a name for the passbolt database username
======================================================
Passbolt database user name:passboltuser
=======================================================
Please enter a new password for the mysql passbolt user
=======================================================
MariaDB passbolt user password: ****
MariaDB passbolt user password (verify): ****
==============================================
Please enter a name for the passbolt database:
==============================================
Passbolt database name:passboltdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;haveged&quot;&gt;Haveged&lt;/h4&gt;

    &lt;p&gt;On virtualized environments GnuPG happen to find not enough entropy to generate a key. Therefore, Passbolt will not run properly.&lt;/p&gt;

    &lt;p&gt;You should consider to install Haveged to speed up the entropy generation. Please check &lt;a href=&quot;https://help.passbolt.com/faq/hosting/why-haveged-virtual-env&quot;&gt;our FAQ page about this&lt;/a&gt; for more informations.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Install Haveged ?
==================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

    &lt;p&gt;Please enter the domain name under which passbolt will run.&lt;/p&gt;

    &lt;p&gt;Note this hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let’s encrypt if you don’t have your own SSL certificates.&lt;/p&gt;

    &lt;p&gt;If you don’t have a domain name and you do not plan to use let’s encrypt please enter the ip address to access this machine.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=========
Hostname: passbolt.domain.tld
=========
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;ssl-configuration&quot;&gt;SSL configuration&lt;/h4&gt;

    &lt;p&gt;3 available choices for SSL configuration:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;manual: Prompts for the path of user uploaded ssl certificates and set up nginx&lt;/li&gt;
      &lt;li&gt;auto:   Will issue a free SSL certificate with https://www.letsencrypt.org and set up nginx&lt;/li&gt;
      &lt;li&gt;none:   Do not setup HTTPS at all&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you choose &lt;strong&gt;1&lt;/strong&gt;, you will be prompted for the full path of your certificates:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;migrate-nginx&quot;&gt;Migrate nginx&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new RockyLinux server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;Your subscription key&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Create the subscription key file&lt;/p&gt;

    &lt;p&gt;You received your subscription key by email, copy it as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passbolt/subscription_key.txt&lt;/code&gt; on your server.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown nginx:nginx /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey_private.asc
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R nginx:nginx /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Migrate passbolt to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 7.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="pro" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt PRO to a new Red Hat server</title><link href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-redhat-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt PRO to a new Red Hat server" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-redhat-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-redhat-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new Red Hat server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal Red Hat 8 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-red-hat-server&quot;&gt;Prepare the new Red Hat server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt PRO and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Configure Extra Packages for Enterprise Linux (EPEL) repository&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install epel-release
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on &lt;a href=&quot;https://getfedora.org/security/&quot;&gt;this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Configure Remi’s RPM repository&lt;/p&gt;

    &lt;p&gt;As Red Hat 8 don’t provide the mandatory &lt;strong&gt;php-pecl-gnupg&lt;/strong&gt; package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.&lt;/p&gt;

    &lt;p&gt;Install Remi repository configuration package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-8.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches &lt;a href=&quot;https://blog.remirepo.net/pages/Config-en&quot;&gt;with the one on the bottom of this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Enable the module stream for PHP 7.4:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf module reset php
sudo dnf module install php:remi-7.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Let’s Encrypt&lt;/p&gt;

    &lt;p&gt;Install certbot if you plan to manage your SSL certificates with &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Add passbolt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/pro/rpm/el8/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install passbolt-pro-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Importing GPG key 0xC155581D:
 Userid     : &quot;Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;&quot;
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb--nginx--ssl-settings&quot;&gt;MariaDB / Nginx / SSL settings&lt;/h4&gt;

    &lt;p&gt;Passbolt PRO RPM package on Red Hat 8 come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.&lt;/p&gt;

    &lt;p&gt;You must prepare beforehand your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.&lt;/p&gt;

    &lt;p&gt;Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.&lt;/p&gt;

    &lt;p&gt;Launch &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-configure&lt;/code&gt; tool and answer to the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo /usr/local/bin/passbolt-configure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb&quot;&gt;MariaDB&lt;/h4&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================
Do you want to configure a local mariadb server on this machine?
================================================================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Answer &lt;strong&gt;1&lt;/strong&gt; for yes if you want to configure a local MariaDB database, otherwise &lt;strong&gt;2&lt;/strong&gt; for no if you plan to use an existing one.&lt;/p&gt;

    &lt;p&gt;If you chose yes, answer the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=======================================================
Please enter a new password for the root database user:
=======================================================
MariaDB Root Password: ****
MariaDB Root Password (verify): ****
======================================================
Please enter a name for the passbolt database username
======================================================
Passbolt database user name:passboltuser
=======================================================
Please enter a new password for the mysql passbolt user
=======================================================
MariaDB passbolt user password: ****
MariaDB passbolt user password (verify): ****
==============================================
Please enter a name for the passbolt database:
==============================================
Passbolt database name:passboltdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;haveged&quot;&gt;Haveged&lt;/h4&gt;

    &lt;p&gt;On virtualized environments GnuPG happen to find not enough entropy to generate a key. Therefore, Passbolt will not run properly.&lt;/p&gt;

    &lt;p&gt;You should consider to install Haveged to speed up the entropy generation. Please check &lt;a href=&quot;https://help.passbolt.com/faq/hosting/why-haveged-virtual-env&quot;&gt;our FAQ page about this&lt;/a&gt; for more informations.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Install Haveged ?
==================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

    &lt;p&gt;Please enter the domain name under which passbolt will run.&lt;/p&gt;

    &lt;p&gt;Note this hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let’s encrypt if you don’t have your own SSL certificates.&lt;/p&gt;

    &lt;p&gt;If you don’t have a domain name and you do not plan to use let’s encrypt please enter the ip address to access this machine.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=========
Hostname: passbolt.domain.tld
=========
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;ssl-configuration&quot;&gt;SSL configuration&lt;/h4&gt;

    &lt;p&gt;3 available choices for SSL configuration:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;manual: Prompts for the path of user uploaded ssl certificates and set up nginx&lt;/li&gt;
      &lt;li&gt;auto:   Will issue a free SSL certificate with https://www.letsencrypt.org and set up nginx&lt;/li&gt;
      &lt;li&gt;none:   Do not setup HTTPS at all&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you choose &lt;strong&gt;1&lt;/strong&gt;, you will be prompted for the full path of your certificates:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;migrate-nginx&quot;&gt;Migrate nginx&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new Red Hat server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;Your subscription key&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Create the subscription key file&lt;/p&gt;

    &lt;p&gt;You received your subscription key by email, copy it as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passbolt/subscription_key.txt&lt;/code&gt; on your server.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown nginx:nginx /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey_private.asc
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R nginx:nginx /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Migrate passbolt to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 7.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="pro" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt PRO to a new OracleLinux server</title><link href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-oraclelinux-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt PRO to a new OracleLinux server" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-oraclelinux-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-oraclelinux-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new OracleLinux server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal OracleLinux 8 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-oraclelinux-server&quot;&gt;Prepare the new OracleLinux server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt PRO and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Configure Extra Packages for Enterprise Linux (EPEL) repository&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on &lt;a href=&quot;https://getfedora.org/security/&quot;&gt;this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Configure Remi’s RPM repository&lt;/p&gt;

    &lt;p&gt;As OracleLinux 8 don’t provide the mandatory &lt;strong&gt;php-pecl-gnupg&lt;/strong&gt; package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.&lt;/p&gt;

    &lt;p&gt;Install Remi repository configuration package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-8.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches &lt;a href=&quot;https://blog.remirepo.net/pages/Config-en&quot;&gt;with the one on the bottom of this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Enable the module stream for PHP 7.4:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf module reset php
sudo dnf module install php:remi-7.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Let’s Encrypt&lt;/p&gt;

    &lt;p&gt;Install certbot if you plan to manage your SSL certificates with &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Add passbolt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/pro/rpm/el8/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install passbolt-pro-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Importing GPG key 0xC155581D:
 Userid     : &quot;Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;&quot;
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb--nginx--ssl-settings&quot;&gt;MariaDB / Nginx / SSL settings&lt;/h4&gt;

    &lt;p&gt;Passbolt PRO RPM package on OracleLinux 8 come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.&lt;/p&gt;

    &lt;p&gt;You must prepare beforehand your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.&lt;/p&gt;

    &lt;p&gt;Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.&lt;/p&gt;

    &lt;p&gt;Launch &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-configure&lt;/code&gt; tool and answer to the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo /usr/local/bin/passbolt-configure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb&quot;&gt;MariaDB&lt;/h4&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================
Do you want to configure a local mariadb server on this machine?
================================================================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Answer &lt;strong&gt;1&lt;/strong&gt; for yes if you want to configure a local MariaDB database, otherwise &lt;strong&gt;2&lt;/strong&gt; for no if you plan to use an existing one.&lt;/p&gt;

    &lt;p&gt;If you chose yes, answer the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=======================================================
Please enter a new password for the root database user:
=======================================================
MariaDB Root Password: ****
MariaDB Root Password (verify): ****
======================================================
Please enter a name for the passbolt database username
======================================================
Passbolt database user name:passboltuser
=======================================================
Please enter a new password for the mysql passbolt user
=======================================================
MariaDB passbolt user password: ****
MariaDB passbolt user password (verify): ****
==============================================
Please enter a name for the passbolt database:
==============================================
Passbolt database name:passboltdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;haveged&quot;&gt;Haveged&lt;/h4&gt;

    &lt;p&gt;On virtualized environments GnuPG happen to find not enough entropy to generate a key. Therefore, Passbolt will not run properly.&lt;/p&gt;

    &lt;p&gt;You should consider to install Haveged to speed up the entropy generation. Please check &lt;a href=&quot;https://help.passbolt.com/faq/hosting/why-haveged-virtual-env&quot;&gt;our FAQ page about this&lt;/a&gt; for more informations.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Install Haveged ?
==================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

    &lt;p&gt;Please enter the domain name under which passbolt will run.&lt;/p&gt;

    &lt;p&gt;Note this hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let’s encrypt if you don’t have your own SSL certificates.&lt;/p&gt;

    &lt;p&gt;If you don’t have a domain name and you do not plan to use let’s encrypt please enter the ip address to access this machine.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=========
Hostname: passbolt.domain.tld
=========
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;ssl-configuration&quot;&gt;SSL configuration&lt;/h4&gt;

    &lt;p&gt;3 available choices for SSL configuration:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;manual: Prompts for the path of user uploaded ssl certificates and set up nginx&lt;/li&gt;
      &lt;li&gt;auto:   Will issue a free SSL certificate with https://www.letsencrypt.org and set up nginx&lt;/li&gt;
      &lt;li&gt;none:   Do not setup HTTPS at all&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you choose &lt;strong&gt;1&lt;/strong&gt;, you will be prompted for the full path of your certificates:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;migrate-nginx&quot;&gt;Migrate nginx&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new OracleLinux server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;Your subscription key&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Create the subscription key file&lt;/p&gt;

    &lt;p&gt;You received your subscription key by email, copy it as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passbolt/subscription_key.txt&lt;/code&gt; on your server.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown nginx:nginx /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey_private.asc
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R nginx:nginx /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Migrate passbolt to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 7.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="pro" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt PRO to a new AlmaLinux server</title><link href="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-almalinux-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt PRO to a new AlmaLinux server" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-almalinux-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/pro/migrate-existing-pro-to-almalinux-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new AlmaLinux server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal AlmaLinux 8 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-almalinux-server&quot;&gt;Prepare the new AlmaLinux server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt PRO and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Configure Extra Packages for Enterprise Linux (EPEL) repository&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install epel-release
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on &lt;a href=&quot;https://getfedora.org/security/&quot;&gt;this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Configure Remi’s RPM repository&lt;/p&gt;

    &lt;p&gt;As AlmaLinux 8 don’t provide the mandatory &lt;strong&gt;php-pecl-gnupg&lt;/strong&gt; package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.&lt;/p&gt;

    &lt;p&gt;Install Remi repository configuration package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-8.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches &lt;a href=&quot;https://blog.remirepo.net/pages/Config-en&quot;&gt;with the one on the bottom of this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Enable the module stream for PHP 7.4:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf module reset php
sudo dnf module install php:remi-7.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Let’s Encrypt&lt;/p&gt;

    &lt;p&gt;Install certbot if you plan to manage your SSL certificates with &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Add passbolt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/pro/rpm/el8/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install passbolt-pro-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Importing GPG key 0xC155581D:
 Userid     : &quot;Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;&quot;
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb--nginx--ssl-settings&quot;&gt;MariaDB / Nginx / SSL settings&lt;/h4&gt;

    &lt;p&gt;Passbolt PRO RPM package on AlmaLinux 8 come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.&lt;/p&gt;

    &lt;p&gt;You must prepare beforehand your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.&lt;/p&gt;

    &lt;p&gt;Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.&lt;/p&gt;

    &lt;p&gt;Launch &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-configure&lt;/code&gt; tool and answer to the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo /usr/local/bin/passbolt-configure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb&quot;&gt;MariaDB&lt;/h4&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================
Do you want to configure a local mariadb server on this machine?
================================================================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Answer &lt;strong&gt;1&lt;/strong&gt; for yes if you want to configure a local MariaDB database, otherwise &lt;strong&gt;2&lt;/strong&gt; for no if you plan to use an existing one.&lt;/p&gt;

    &lt;p&gt;If you chose yes, answer the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=======================================================
Please enter a new password for the root database user:
=======================================================
MariaDB Root Password: ****
MariaDB Root Password (verify): ****
======================================================
Please enter a name for the passbolt database username
======================================================
Passbolt database user name:passboltuser
=======================================================
Please enter a new password for the mysql passbolt user
=======================================================
MariaDB passbolt user password: ****
MariaDB passbolt user password (verify): ****
==============================================
Please enter a name for the passbolt database:
==============================================
Passbolt database name:passboltdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;haveged&quot;&gt;Haveged&lt;/h4&gt;

    &lt;p&gt;On virtualized environments GnuPG happen to find not enough entropy to generate a key. Therefore, Passbolt will not run properly.&lt;/p&gt;

    &lt;p&gt;You should consider to install Haveged to speed up the entropy generation. Please check &lt;a href=&quot;https://help.passbolt.com/faq/hosting/why-haveged-virtual-env&quot;&gt;our FAQ page about this&lt;/a&gt; for more informations.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Install Haveged ?
==================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

    &lt;p&gt;Please enter the domain name under which passbolt will run.&lt;/p&gt;

    &lt;p&gt;Note this hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let’s encrypt if you don’t have your own SSL certificates.&lt;/p&gt;

    &lt;p&gt;If you don’t have a domain name and you do not plan to use let’s encrypt please enter the ip address to access this machine.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=========
Hostname: passbolt.domain.tld
=========
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;ssl-configuration&quot;&gt;SSL configuration&lt;/h4&gt;

    &lt;p&gt;3 available choices for SSL configuration:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;manual: Prompts for the path of user uploaded ssl certificates and set up nginx&lt;/li&gt;
      &lt;li&gt;auto:   Will issue a free SSL certificate with https://www.letsencrypt.org and set up nginx&lt;/li&gt;
      &lt;li&gt;none:   Do not setup HTTPS at all&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you choose &lt;strong&gt;1&lt;/strong&gt;, you will be prompted for the full path of your certificates:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;migrate-nginx&quot;&gt;Migrate nginx&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new AlmaLinux server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;Your subscription key&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Create the subscription key file&lt;/p&gt;

    &lt;p&gt;You received your subscription key by email, copy it as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passbolt/subscription_key.txt&lt;/code&gt; on your server.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown nginx:nginx /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey_private.asc
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R nginx:nginx /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Migrate passbolt to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 7.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="pro" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt CE to a new RockyLinux server</title><link href="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-rockylinux-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt CE to a new RockyLinux server" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-rockylinux-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-rockylinux-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new RockyLinux server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal RockyLinux 8 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-rockylinux-server&quot;&gt;Prepare the new RockyLinux server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt CE and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Configure Extra Packages for Enterprise Linux (EPEL) repository&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install epel-release
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on &lt;a href=&quot;https://getfedora.org/security/&quot;&gt;this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Configure Remi’s RPM repository&lt;/p&gt;

    &lt;p&gt;As RockyLinux 8 don’t provide the mandatory &lt;strong&gt;php-pecl-gnupg&lt;/strong&gt; package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.&lt;/p&gt;

    &lt;p&gt;Install Remi repository configuration package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-8.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches &lt;a href=&quot;https://blog.remirepo.net/pages/Config-en&quot;&gt;with the one on the bottom of this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Enable the module stream for PHP 7.4:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf module reset php
sudo dnf module install php:remi-7.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Let’s Encrypt&lt;/p&gt;

    &lt;p&gt;Install certbot if you plan to manage your SSL certificates with &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Add passbolt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/ce/rpm/el8/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install passbolt-ce-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Importing GPG key 0xC155581D:
 Userid     : &quot;Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;&quot;
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb--nginx--ssl-settings&quot;&gt;MariaDB / Nginx / SSL settings&lt;/h4&gt;

    &lt;p&gt;Passbolt CE RPM package on RockyLinux 8 come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.&lt;/p&gt;

    &lt;p&gt;You must prepare beforehand your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.&lt;/p&gt;

    &lt;p&gt;Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.&lt;/p&gt;

    &lt;p&gt;Launch &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-configure&lt;/code&gt; tool and answer to the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo /usr/local/bin/passbolt-configure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb&quot;&gt;MariaDB&lt;/h4&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================
Do you want to configure a local mariadb server on this machine?
================================================================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Answer &lt;strong&gt;1&lt;/strong&gt; for yes if you want to configure a local MariaDB database, otherwise &lt;strong&gt;2&lt;/strong&gt; for no if you plan to use an existing one.&lt;/p&gt;

    &lt;p&gt;If you chose yes, answer the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=======================================================
Please enter a new password for the root database user:
=======================================================
MariaDB Root Password: ****
MariaDB Root Password (verify): ****
======================================================
Please enter a name for the passbolt database username
======================================================
Passbolt database user name:passboltuser
=======================================================
Please enter a new password for the mysql passbolt user
=======================================================
MariaDB passbolt user password: ****
MariaDB passbolt user password (verify): ****
==============================================
Please enter a name for the passbolt database:
==============================================
Passbolt database name:passboltdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;haveged&quot;&gt;Haveged&lt;/h4&gt;

    &lt;p&gt;On virtualized environments GnuPG happen to find not enough entropy to generate a key. Therefore, Passbolt will not run properly.&lt;/p&gt;

    &lt;p&gt;You should consider to install Haveged to speed up the entropy generation. Please check &lt;a href=&quot;https://help.passbolt.com/faq/hosting/why-haveged-virtual-env&quot;&gt;our FAQ page about this&lt;/a&gt; for more informations.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Install Haveged ?
==================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

    &lt;p&gt;Please enter the domain name under which passbolt will run.&lt;/p&gt;

    &lt;p&gt;Note this hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let’s encrypt if you don’t have your own SSL certificates.&lt;/p&gt;

    &lt;p&gt;If you don’t have a domain name and you do not plan to use let’s encrypt please enter the ip address to access this machine.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=========
Hostname: passbolt.domain.tld
=========
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;ssl-configuration&quot;&gt;SSL configuration&lt;/h4&gt;

    &lt;p&gt;3 available choices for SSL configuration:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;manual: Prompts for the path of user uploaded ssl certificates and set up nginx&lt;/li&gt;
      &lt;li&gt;auto:   Will issue a free SSL certificate with https://www.letsencrypt.org and set up nginx&lt;/li&gt;
      &lt;li&gt;none:   Do not setup HTTPS at all&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you choose &lt;strong&gt;1&lt;/strong&gt;, you will be prompted for the full path of your certificates:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;migrate-nginx&quot;&gt;Migrate nginx&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new RockyLinux server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown nginx:nginx /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey_private.asc
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R nginx:nginx /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Migrate passbolt to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="ce" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt CE to a new Red Hat server</title><link href="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-redhat-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt CE to a new Red Hat server" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-redhat-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-redhat-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new Red Hat server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal Red Hat 8 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-red-hat-server&quot;&gt;Prepare the new Red Hat server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt CE and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Configure Extra Packages for Enterprise Linux (EPEL) repository&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install epel-release
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on &lt;a href=&quot;https://getfedora.org/security/&quot;&gt;this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Configure Remi’s RPM repository&lt;/p&gt;

    &lt;p&gt;As Red Hat 8 don’t provide the mandatory &lt;strong&gt;php-pecl-gnupg&lt;/strong&gt; package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.&lt;/p&gt;

    &lt;p&gt;Install Remi repository configuration package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-8.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches &lt;a href=&quot;https://blog.remirepo.net/pages/Config-en&quot;&gt;with the one on the bottom of this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Enable the module stream for PHP 7.4:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf module reset php
sudo dnf module install php:remi-7.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Let’s Encrypt&lt;/p&gt;

    &lt;p&gt;Install certbot if you plan to manage your SSL certificates with &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Add passbolt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/ce/rpm/el8/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install passbolt-ce-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Importing GPG key 0xC155581D:
 Userid     : &quot;Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;&quot;
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb--nginx--ssl-settings&quot;&gt;MariaDB / Nginx / SSL settings&lt;/h4&gt;

    &lt;p&gt;Passbolt CE RPM package on Red Hat 8 come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.&lt;/p&gt;

    &lt;p&gt;You must prepare beforehand your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.&lt;/p&gt;

    &lt;p&gt;Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.&lt;/p&gt;

    &lt;p&gt;Launch &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-configure&lt;/code&gt; tool and answer to the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo /usr/local/bin/passbolt-configure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb&quot;&gt;MariaDB&lt;/h4&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================
Do you want to configure a local mariadb server on this machine?
================================================================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Answer &lt;strong&gt;1&lt;/strong&gt; for yes if you want to configure a local MariaDB database, otherwise &lt;strong&gt;2&lt;/strong&gt; for no if you plan to use an existing one.&lt;/p&gt;

    &lt;p&gt;If you chose yes, answer the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=======================================================
Please enter a new password for the root database user:
=======================================================
MariaDB Root Password: ****
MariaDB Root Password (verify): ****
======================================================
Please enter a name for the passbolt database username
======================================================
Passbolt database user name:passboltuser
=======================================================
Please enter a new password for the mysql passbolt user
=======================================================
MariaDB passbolt user password: ****
MariaDB passbolt user password (verify): ****
==============================================
Please enter a name for the passbolt database:
==============================================
Passbolt database name:passboltdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;haveged&quot;&gt;Haveged&lt;/h4&gt;

    &lt;p&gt;On virtualized environments GnuPG happen to find not enough entropy to generate a key. Therefore, Passbolt will not run properly.&lt;/p&gt;

    &lt;p&gt;You should consider to install Haveged to speed up the entropy generation. Please check &lt;a href=&quot;https://help.passbolt.com/faq/hosting/why-haveged-virtual-env&quot;&gt;our FAQ page about this&lt;/a&gt; for more informations.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Install Haveged ?
==================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

    &lt;p&gt;Please enter the domain name under which passbolt will run.&lt;/p&gt;

    &lt;p&gt;Note this hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let’s encrypt if you don’t have your own SSL certificates.&lt;/p&gt;

    &lt;p&gt;If you don’t have a domain name and you do not plan to use let’s encrypt please enter the ip address to access this machine.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=========
Hostname: passbolt.domain.tld
=========
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;ssl-configuration&quot;&gt;SSL configuration&lt;/h4&gt;

    &lt;p&gt;3 available choices for SSL configuration:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;manual: Prompts for the path of user uploaded ssl certificates and set up nginx&lt;/li&gt;
      &lt;li&gt;auto:   Will issue a free SSL certificate with https://www.letsencrypt.org and set up nginx&lt;/li&gt;
      &lt;li&gt;none:   Do not setup HTTPS at all&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you choose &lt;strong&gt;1&lt;/strong&gt;, you will be prompted for the full path of your certificates:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;migrate-nginx&quot;&gt;Migrate nginx&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new Red Hat server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown nginx:nginx /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey_private.asc
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R nginx:nginx /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Migrate passbolt to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="ce" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt CE to a new OracleLinux server</title><link href="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-oraclelinux-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt CE to a new OracleLinux server" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-oraclelinux-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-oraclelinux-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new OracleLinux server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal OracleLinux 8 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-oraclelinux-server&quot;&gt;Prepare the new OracleLinux server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt CE and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Configure Extra Packages for Enterprise Linux (EPEL) repository&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on &lt;a href=&quot;https://getfedora.org/security/&quot;&gt;this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Configure Remi’s RPM repository&lt;/p&gt;

    &lt;p&gt;As OracleLinux 8 don’t provide the mandatory &lt;strong&gt;php-pecl-gnupg&lt;/strong&gt; package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.&lt;/p&gt;

    &lt;p&gt;Install Remi repository configuration package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-8.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches &lt;a href=&quot;https://blog.remirepo.net/pages/Config-en&quot;&gt;with the one on the bottom of this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Enable the module stream for PHP 7.4:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf module reset php
sudo dnf module install php:remi-7.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Let’s Encrypt&lt;/p&gt;

    &lt;p&gt;Install certbot if you plan to manage your SSL certificates with &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Add passbolt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/ce/rpm/el8/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install passbolt-ce-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Importing GPG key 0xC155581D:
 Userid     : &quot;Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;&quot;
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb--nginx--ssl-settings&quot;&gt;MariaDB / Nginx / SSL settings&lt;/h4&gt;

    &lt;p&gt;Passbolt CE RPM package on OracleLinux 8 come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.&lt;/p&gt;

    &lt;p&gt;You must prepare beforehand your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.&lt;/p&gt;

    &lt;p&gt;Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.&lt;/p&gt;

    &lt;p&gt;Launch &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-configure&lt;/code&gt; tool and answer to the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo /usr/local/bin/passbolt-configure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb&quot;&gt;MariaDB&lt;/h4&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================
Do you want to configure a local mariadb server on this machine?
================================================================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Answer &lt;strong&gt;1&lt;/strong&gt; for yes if you want to configure a local MariaDB database, otherwise &lt;strong&gt;2&lt;/strong&gt; for no if you plan to use an existing one.&lt;/p&gt;

    &lt;p&gt;If you chose yes, answer the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=======================================================
Please enter a new password for the root database user:
=======================================================
MariaDB Root Password: ****
MariaDB Root Password (verify): ****
======================================================
Please enter a name for the passbolt database username
======================================================
Passbolt database user name:passboltuser
=======================================================
Please enter a new password for the mysql passbolt user
=======================================================
MariaDB passbolt user password: ****
MariaDB passbolt user password (verify): ****
==============================================
Please enter a name for the passbolt database:
==============================================
Passbolt database name:passboltdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;haveged&quot;&gt;Haveged&lt;/h4&gt;

    &lt;p&gt;On virtualized environments GnuPG happen to find not enough entropy to generate a key. Therefore, Passbolt will not run properly.&lt;/p&gt;

    &lt;p&gt;You should consider to install Haveged to speed up the entropy generation. Please check &lt;a href=&quot;https://help.passbolt.com/faq/hosting/why-haveged-virtual-env&quot;&gt;our FAQ page about this&lt;/a&gt; for more informations.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Install Haveged ?
==================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

    &lt;p&gt;Please enter the domain name under which passbolt will run.&lt;/p&gt;

    &lt;p&gt;Note this hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let’s encrypt if you don’t have your own SSL certificates.&lt;/p&gt;

    &lt;p&gt;If you don’t have a domain name and you do not plan to use let’s encrypt please enter the ip address to access this machine.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=========
Hostname: passbolt.domain.tld
=========
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;ssl-configuration&quot;&gt;SSL configuration&lt;/h4&gt;

    &lt;p&gt;3 available choices for SSL configuration:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;manual: Prompts for the path of user uploaded ssl certificates and set up nginx&lt;/li&gt;
      &lt;li&gt;auto:   Will issue a free SSL certificate with https://www.letsencrypt.org and set up nginx&lt;/li&gt;
      &lt;li&gt;none:   Do not setup HTTPS at all&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you choose &lt;strong&gt;1&lt;/strong&gt;, you will be prompted for the full path of your certificates:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;migrate-nginx&quot;&gt;Migrate nginx&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new OracleLinux server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown nginx:nginx /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey_private.asc
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R nginx:nginx /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Migrate passbolt to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="ce" /><summary type="html"></summary></entry><entry><title type="html">Migrate an existing Passbolt CE to a new AlmaLinux server</title><link href="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-almalinux-server.html" rel="alternate" type="text/html" title="Migrate an existing Passbolt CE to a new AlmaLinux server" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-almalinux-server</id><content type="html" xml:base="https://help.passbolt.com/hosting/upgrade/ce/migrate-existing-ce-to-almalinux-server.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;p&gt;This document describes how to migrate an existing passbolt to a new AlmaLinux server.&lt;/p&gt;

    &lt;h2 id=&quot;pre-requisites&quot;&gt;Pre-requisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Passbolt installed on an old server&lt;/li&gt;
      &lt;li&gt;A minimal AlmaLinux 8 new server&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;backup-the-existing-data&quot;&gt;Backup the existing data&lt;/h2&gt;

    &lt;p&gt;Prior to the migration you will need to backup the existing passbolt instance data. Please refer to &lt;a href=&quot;/hosting/backup&quot;&gt;the official backup documentations&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;Depending on your SSL configuration you might need to copy the certificate and key from the existing instance. If you are using let’s encrypt you can continue you’ll configure it later directly in the new server.&lt;/p&gt;

    &lt;p&gt;Don’t delete the existing instance yet!&lt;/p&gt;

    &lt;h2 id=&quot;prepare-the-new-almalinux-server&quot;&gt;Prepare the new AlmaLinux server&lt;/h2&gt;

    &lt;h2 id=&quot;install-the-server-components&quot;&gt;1. Install the server components&lt;/h2&gt;
    &lt;h3 id=&quot;package-repository-setup&quot;&gt;1.1. Package repository setup&lt;/h3&gt;

    &lt;p&gt;For easier installation and update tasks Passbolt provides a package repository that you need to setup
before you download Passbolt CE and install it.&lt;/p&gt;

    &lt;p&gt;These steps assume you have already installed sudo and added your user to the sudo group.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Configure Extra Packages for Enterprise Linux (EPEL) repository&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install epel-release
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;While installing packages from this repository, you will be asked to accept GPG key of this repository. You nust verify if the displayed fingerprint is correct on &lt;a href=&quot;https://getfedora.org/security/&quot;&gt;this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Configure Remi’s RPM repository&lt;/p&gt;

    &lt;p&gt;As AlmaLinux 8 don’t provide the mandatory &lt;strong&gt;php-pecl-gnupg&lt;/strong&gt; package for Passbolt, we rely on Remi’s RPM repository for the PHP packages.&lt;/p&gt;

    &lt;p&gt;Install Remi repository configuration package.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install https://rpms.remirepo.net/enterprise/remi-release-8.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the next package installations, if you are prompted for Remi GPG key import, you must check if the displayed fingerprint matches &lt;a href=&quot;https://blog.remirepo.net/pages/Config-en&quot;&gt;with the one on the bottom of this reference page&lt;/a&gt;.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Enable the module stream for PHP 7.4:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf module reset php
sudo dnf module install php:remi-7.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Let’s Encrypt&lt;/p&gt;

    &lt;p&gt;Install certbot if you plan to manage your SSL certificates with &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install certbot python3-certbot-nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt;  Add passbolt repository:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat &amp;lt;&amp;lt; EOF | sudo tee /etc/yum.repos.d/passbolt.repo
[passbolt-server]
name=Passbolt Server
baseurl=https://download.passbolt.com/ce/rpm/el8/stable
enabled=1
gpgcheck=1
gpgkey=https://download.passbolt.com/pub.key
EOF
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;install-passbolt-package&quot;&gt;Install passbolt package&lt;/h4&gt;

    &lt;p&gt;Install the main passbolt server component:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo dnf install passbolt-ce-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;During the installation, you will be asked to accept the Passbolt repository GPG key. You must ensure the fingerprint is exactly the same as the one below:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Importing GPG key 0xC155581D:
 Userid     : &quot;Passbolt SA package signing key &amp;lt;contact@passbolt.com&amp;gt;&quot;
 Fingerprint: 3D1A 0346 C8E1 802F 774A EF21 DE8B 853F C155 581D
 From       : https://download.passbolt.com/pub.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb--nginx--ssl-settings&quot;&gt;MariaDB / Nginx / SSL settings&lt;/h4&gt;

    &lt;p&gt;Passbolt CE RPM package on AlmaLinux 8 come with a configuration helper tool to prepare MariaDB, Nginx and SSL settings.&lt;/p&gt;

    &lt;p&gt;You must prepare beforehand your SSL certificates before launching the tool. Be sure to write down the full path to your cert/key combo, as it will be needed in the nginx configuration process.&lt;/p&gt;

    &lt;p&gt;Please, notice that for security matters we highly recommend to setup SSL to serve passbolt.&lt;/p&gt;

    &lt;p&gt;Launch &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-configure&lt;/code&gt; tool and answer to the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo /usr/local/bin/passbolt-configure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;mariadb&quot;&gt;MariaDB&lt;/h4&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;================================================================
Do you want to configure a local mariadb server on this machine?
================================================================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Answer &lt;strong&gt;1&lt;/strong&gt; for yes if you want to configure a local MariaDB database, otherwise &lt;strong&gt;2&lt;/strong&gt; for no if you plan to use an existing one.&lt;/p&gt;

    &lt;p&gt;If you chose yes, answer the questions:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=======================================================
Please enter a new password for the root database user:
=======================================================
MariaDB Root Password: ****
MariaDB Root Password (verify): ****
======================================================
Please enter a name for the passbolt database username
======================================================
Passbolt database user name:passboltuser
=======================================================
Please enter a new password for the mysql passbolt user
=======================================================
MariaDB passbolt user password: ****
MariaDB passbolt user password (verify): ****
==============================================
Please enter a name for the passbolt database:
==============================================
Passbolt database name:passboltdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;haveged&quot;&gt;Haveged&lt;/h4&gt;

    &lt;p&gt;On virtualized environments GnuPG happen to find not enough entropy to generate a key. Therefore, Passbolt will not run properly.&lt;/p&gt;

    &lt;p&gt;You should consider to install Haveged to speed up the entropy generation. Please check &lt;a href=&quot;https://help.passbolt.com/faq/hosting/why-haveged-virtual-env&quot;&gt;our FAQ page about this&lt;/a&gt; for more informations.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Install Haveged ?
==================
1) yes
2) no
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

    &lt;p&gt;Please enter the domain name under which passbolt will run.&lt;/p&gt;

    &lt;p&gt;Note this hostname will be used as server_name for nginx and as the domain name to register a SSL certificate with let’s encrypt if you don’t have your own SSL certificates.&lt;/p&gt;

    &lt;p&gt;If you don’t have a domain name and you do not plan to use let’s encrypt please enter the ip address to access this machine.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=========
Hostname: passbolt.domain.tld
=========
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;ssl-configuration&quot;&gt;SSL configuration&lt;/h4&gt;

    &lt;p&gt;3 available choices for SSL configuration:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;manual: Prompts for the path of user uploaded ssl certificates and set up nginx&lt;/li&gt;
      &lt;li&gt;auto:   Will issue a free SSL certificate with https://www.letsencrypt.org and set up nginx&lt;/li&gt;
      &lt;li&gt;none:   Do not setup HTTPS at all&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==================
Setting up SSL...
==================
1) manual
2) auto
3) none
#?
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;If you choose &lt;strong&gt;1&lt;/strong&gt;, you will be prompted for the full path of your certificates:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Enter the path to the SSL certificate: /path/to/certs/cert.pem
Enter the path to the SSL privkey: /path/to/certs/key.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Nginx and MariaDB are now on the way to be configured. You will be notified at the end of the process to connect to the Passbolt web interface to finish the configuration.&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;===============================================================
Installation is almost complete. Please point your browser to
  https://passbolt.domain.tld to complete the process
===============================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;migrate-nginx&quot;&gt;Migrate nginx&lt;/h2&gt;

    &lt;p&gt;Load the backup files into the new AlmaLinux server, for the following tasks we will consider that the backup files are in your user home directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/backup&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;You should have:&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;the private and public GPG key&lt;/li&gt;
      &lt;li&gt;Your database dump&lt;/li&gt;
      &lt;li&gt;The avatar archive file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passbolt-avatars.tar.gz&lt;/code&gt; if you are coming from Passbolt prior to 3.2&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;Step 1.&lt;/strong&gt; Restore Passbolt configuration file and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/passbolt.php /etc/passbolt
sudo chown nginx:nginx /etc/passbolt/passbolt.php
sudo chmod 440 /etc/passbolt/passbolt.php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 2.&lt;/strong&gt; Restore GPG public and private keys and ensure rights and ownership are correct:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo mv ~/backup/serverkey.asc /etc/passbolt/gpg
sudo mv ~/backup/serverkey_private.asc /etc/passbolt/gpg
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey_private.asc
sudo chown nginx:nginx /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey.asc
sudo chmod 440 /etc/passbolt/gpg/serverkey_private.asc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 3.&lt;/strong&gt; Extract the passbolt-avatars.tar.gz archive and set correct rights (if coming from Passbolt version prior to 3.2)&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tar xzf passbolt-avatars.tar.gz -C /usr/share/php/passbolt/
sudo chown -R nginx:nginx /usr/share/php/passbolt/webroot/img/public
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 4.&lt;/strong&gt; Load the database&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql -u PASSBOLT_DATABASE_USER -p PASSBOLT_DATABASE &amp;lt; passbolt-backup.sql
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 5.&lt;/strong&gt; Migrate passbolt to the latest version&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt migrate&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;&lt;strong&gt;Step 6.&lt;/strong&gt; Test passbolt&lt;/p&gt;

    &lt;p&gt;Try to access your passbolt application with your browser.&lt;/p&gt;

    &lt;p&gt;If you are encountering any issues, you can run the following command to assess the status of your instance:&lt;/p&gt;

    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -H -u nginx /bin/bash -c &quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message tldr&quot;&gt;
    &lt;p&gt;Something is not accurate in this documentation? You can contribute by opening an issue or making pull requests!&lt;/p&gt;
    
    &lt;a href=&quot;https://www.github.com/passbolt/passbolt_help&quot; class=&quot;button &quot;&gt;View on github&lt;/a&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="upgrade" /><category term="ce" /><summary type="html"></summary></entry><entry><title type="html">Update passbolt on RockyLinux</title><link href="https://help.passbolt.com/hosting/update/rockylinux.html" rel="alternate" type="text/html" title="Update passbolt on RockyLinux" /><published>2021-11-26T01:00:00+01:00</published><updated>2021-11-26T01:00:00+01:00</updated><id>https://help.passbolt.com/hosting/update/rockylinux</id><content type="html" xml:base="https://help.passbolt.com/hosting/update/rockylinux.html">&lt;div class=&quot;row&quot;&gt;
  &lt;div class=&quot;col7&quot;&gt;

    &lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;

    &lt;p&gt;For this tutorial, you will need:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;A minimal RockyLinux server.&lt;/li&gt;
      &lt;li&gt;Passbolt RockyLinux package installed.&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2 id=&quot;update-passbolt&quot;&gt;Update passbolt&lt;/h2&gt;
    &lt;h3 id=&quot;take-down-your-site&quot;&gt;1. Take down your site&lt;/h3&gt;

    &lt;p&gt;It is generally a good idea to stop running the site prior to the upgrade. This is to avoid having side effects
such as active users corrupting the data in the middle of an upgrade.&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl stop nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h3 id=&quot;backup-your-database&quot;&gt;2. Backup your database&lt;/h3&gt;

    &lt;p&gt;It is recommended to always perform a backup of your passbolt installation. Please check the &lt;a href=&quot;/hosting/backup&quot;&gt;backup&lt;/a&gt; article&lt;/p&gt;

    &lt;h3 id=&quot;upgrade-your-system&quot;&gt;3. Upgrade your system&lt;/h3&gt;

    &lt;p&gt;This commands will trigger an upgrade on your whole RockyLinux system:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;dnf upgrade
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h3 id=&quot;clear-the-cache&quot;&gt;4. Clear the cache&lt;/h3&gt;

    &lt;p&gt;Finally make sure you clear the application cache, to make sure any changes in the database structure are
reflected in model cache files:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; nginx bash &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/php/passbolt/bin/cake cache clear_all&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h3 id=&quot;take-your-site-back-up&quot;&gt;5. Take your site back up&lt;/h3&gt;

    &lt;p&gt;Almost done:&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;systemctl start nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h2 id=&quot;troubleshooting&quot;&gt;Troubleshooting&lt;/h2&gt;

    &lt;h4 id=&quot;verifying-the-status-of-the-application&quot;&gt;Verifying the status of the application&lt;/h4&gt;
    &lt;p&gt;Optionally, you can login as an administrator and check the status on the healthcheck page:&lt;/p&gt;

    &lt;figure&gt;
    &lt;img src=&quot;https://help.passbolt.com/assets/img/screenshots/AD_healthcheck.jpg&quot; alt=&quot;Example of healthcheck screen&quot; style=&quot;max-width:;&quot; /&gt;
    &lt;span class=&quot;legend&quot;&gt;fig. Example of healthcheck screen&lt;/span&gt;
&lt;/figure&gt;

    &lt;p&gt;You can also run the following command:&lt;/p&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; nginx bash &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/usr/share/php/passbolt/bin/cake passbolt healthcheck&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;h4 id=&quot;if-you-run-into-some-issues&quot;&gt;If you run into some issues&lt;/h4&gt;

    &lt;p&gt;If you run into some issues:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Make a copy or screenshot of the errors messages displayed on the screen&lt;/li&gt;
      &lt;li&gt;Check for error message in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;logs&lt;/code&gt; directory&lt;/li&gt;
      &lt;li&gt;Check for error message in the browser console&lt;/li&gt;
      &lt;li&gt;Checkout the previous working version using git&lt;/li&gt;
      &lt;li&gt;Drop the database and load your backup data to restore to a previously working version&lt;/li&gt;
      &lt;li&gt;Note down the the details of you environment: your OS, php, mysql environment versions.&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;Where to get help:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;If you are a Passbolt Pro Edition subscriber send us an &lt;a href=&quot;mailto:contact@passbolt.com&quot;&gt;email&lt;/a&gt; with the details.&lt;/li&gt;
      &lt;li&gt;If you are a Passbolt Community Edition user you can open new thread on the &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot;&gt;community forum&lt;/a&gt;.&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;The more information you provide about what you did, what you tried, how your environment look like,
the easiest it will be for people to help you.&lt;/p&gt;

    &lt;div class=&quot;last-updated&quot;&gt;
      &lt;h3&gt;Last updated&lt;/h3&gt;
      &lt;p&gt;This article was last updated on 
November
26th,
2021.&lt;/p&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class=&quot;col4 last push1&quot;&gt;

    &lt;div class=&quot;message tldr notice&quot;&gt;
    &lt;p&gt;Are you experiencing issues when updating passbolt?&lt;/p&gt;
    
    &lt;a href=&quot;https://community.passbolt.com/c/installation-issues&quot; class=&quot;button primary&quot;&gt;Ask the community!&lt;/a&gt;
    
&lt;/div&gt;

    &lt;div class=&quot;message &quot;&gt;
    &lt;p&gt;&lt;/p&gt;
    
&lt;/div&gt;

  &lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><category term="hosting" /><category term="update" /><summary type="html"></summary></entry></feed>